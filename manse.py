import streamlit as st
import requests
import json
from datetime import date, datetime

# â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
#  í˜ì´ì§€ ì„¤ì •
# â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
st.set_page_config(
    page_title="ğŸ”® ì‚¬ì£¼íŒ”ì ì²œëª…í’€ì´",
    page_icon="ğŸ”®",
    layout="centered",
    initial_sidebar_state="collapsed"
)

# â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
#  CSS - ëª¨ë°”ì¼ ìµœì í™”
# â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
st.markdown("""
<style>
  @import url('https://fonts.googleapis.com/css2?family=Noto+Serif+KR:wght@400;600;700&display=swap');
  html, body, [class*="css"] { font-family: 'Noto Serif KR', serif; }
  .stApp { background: linear-gradient(160deg,#fdf8f0 0%,#fef9f2 50%,#fdf5e6 100%); }
  .main .block-container { padding: 0 0 2rem 0; max-width: 480px; }
  h1,h2,h3 { color: #7c4a00 !important; }
  .stButton > button {
    background: linear-gradient(135deg,#7c4a00,#a0720a,#7c4a00) !important;
    color: #fff8e0 !important; border: none !important;
    font-weight: bold !important; letter-spacing: 2px !important;
    border-radius: 10px !important; width: 100% !important;
    padding: 12px !important; font-size: 16px !important;
    font-family: 'Noto Serif KR', serif !important;
  }
  .stSelectbox > div > div { background: #faf4e8 !important; border: 1.5px solid #e8d5a0 !important; }
  .stTextInput > div > div > input { background: #faf4e8 !important; border: 1.5px solid #e8d5a0 !important; }
  .stRadio > div { gap: 8px; }
  div[data-testid="stMarkdownContainer"] pre {
    background: #fff8e6 !important; border: 1px solid #e8d5a0 !important;
    border-radius: 10px !important; padding: 16px !important;
    font-family: 'Noto Serif KR', serif !important;
    white-space: pre-wrap !important; font-size: 14px !important;
    color: #2c1f0e !important; line-height: 1.8 !important;
  }
  .header-box {
    background: linear-gradient(135deg,#7c4a00 0%,#a0720a 50%,#7c4a00 100%);
    padding: 22px 24px 18px; text-align: center;
    box-shadow: 0 4px 20px rgba(120,70,0,0.3);
  }
  .header-title { font-size: 26px; font-weight: bold; color: #fff8e0;
    letter-spacing: 8px; text-shadow: 0 2px 8px rgba(0,0,0,0.3); }
  .header-sub { color: rgba(255,245,200,0.7); font-size: 11px; letter-spacing: 4px; margin-top: 4px; }
  .card {
    background: #ffffff; border: 1px solid #e8d5a0;
    border-radius: 14px; padding: 18px 16px;
    box-shadow: 0 2px 12px rgba(160,114,10,0.08);
    margin: 12px 0;
  }
  .pillar-box {
    background: #fff8e6; border: 1px solid #e8d5a0;
    border-radius: 10px; padding: 12px 8px; text-align: center;
    flex: 1;
  }
  .oh-badge {
    display: inline-block; padding: 4px 10px;
    border-radius: 20px; font-size: 12px;
    border: 1px solid #e8d5a0; color: #7a5c2a;
    background: rgba(160,114,10,0.08);
  }
  .tab-btn {
    background: transparent; border: 1.5px solid #f0e4bb;
    border-radius: 8px; color: #c9b080; padding: 7px 10px;
    cursor: pointer; font-size: 11px; letter-spacing: 1px;
    margin: 3px; display: inline-block;
  }
  .tab-btn-active {
    background: rgba(160,114,10,0.12); border: 1.5px solid #a0720a;
    color: #a0720a; font-weight: 700;
  }
  .fortune-text {
    background: #fff8e6; border: 1px solid #e8d5a0;
    border-radius: 12px; padding: 18px 16px;
    font-size: 14px; color: #2c1f0e;
    line-height: 1.9; white-space: pre-wrap;
    font-family: 'Noto Serif KR', serif;
  }
  .gold-section {
    color: #a0720a; font-size: 12px; letter-spacing: 3px;
    border-bottom: 1px solid #f0e4bb; padding-bottom: 6px;
    font-weight: 700; margin: 16px 0 10px;
  }
  .warning-box {
    background: rgba(239,68,68,0.08); border: 1px solid rgba(239,68,68,0.25);
    border-radius: 10px; padding: 10px 14px; font-size: 12px;
    color: #be123c; text-align: center; margin: 10px 0;
  }
  .success-box {
    background: rgba(22,163,74,0.08); border: 1px solid rgba(22,163,74,0.25);
    border-radius: 10px; padding: 10px 14px; font-size: 12px;
    color: #16a34a; text-align: center; margin: 10px 0;
  }
  /* ëª¨ë°”ì¼ ìµœì í™” */
  @media (max-width: 600px) {
    .main .block-container { padding: 0 0 2rem 0 !important; }
    .header-title { font-size: 20px; letter-spacing: 4px; }
  }
  /* íƒ­ ë²„íŠ¼ ê°ì¶”ê¸° */
  .stTabs [data-baseweb="tab-list"] {
    gap: 4px; flex-wrap: wrap;
    background: #fff8e6; border-radius: 10px; padding: 6px;
  }
  .stTabs [data-baseweb="tab"] {
    font-size: 12px !important; padding: 6px 10px !important;
    color: #7a5c2a !important;
  }
  .stTabs [aria-selected="true"] {
    background: #a0720a !important; color: #fff8e0 !important;
    border-radius: 6px !important;
  }
</style>
""", unsafe_allow_html=True)

# â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
#  ìƒìˆ˜ ì •ì˜
# â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
CG = ["ç”²","ä¹™","ä¸™","ä¸","æˆŠ","å·±","åºš","è¾›","å£¬","ç™¸"]
CG_KR = ["ê°‘","ì„","ë³‘","ì •","ë¬´","ê¸°","ê²½","ì‹ ","ì„","ê³„"]
JJ = ["å­","ä¸‘","å¯…","å¯","è¾°","å·³","åˆ","æœª","ç”³","é…‰","æˆŒ","äº¥"]
JJ_KR = ["ì","ì¶•","ì¸","ë¬˜","ì§„","ì‚¬","ì˜¤","ë¯¸","ì‹ ","ìœ ","ìˆ ","í•´"]
JJ_AN = ["ì¥","ì†Œ","í˜¸ë‘ì´","í† ë¼","ìš©","ë±€","ë§","ì–‘","ì›ìˆ­ì´","ë‹­","ê°œ","ë¼ì§€"]

OH = {
    "ç”²":"æœ¨","ä¹™":"æœ¨","ä¸™":"ç«","ä¸":"ç«","æˆŠ":"åœŸ","å·±":"åœŸ",
    "åºš":"é‡‘","è¾›":"é‡‘","å£¬":"æ°´","ç™¸":"æ°´",
    "å­":"æ°´","ä¸‘":"åœŸ","å¯…":"æœ¨","å¯":"æœ¨","è¾°":"åœŸ","å·³":"ç«",
    "åˆ":"ç«","æœª":"åœŸ","ç”³":"é‡‘","é…‰":"é‡‘","æˆŒ":"åœŸ","äº¥":"æ°´"
}
OHN = {"æœ¨":"ë‚˜ë¬´","ç«":"ë¶ˆ","åœŸ":"í™","é‡‘":"ì‡ ","æ°´":"ë¬¼"}
OHE = {"æœ¨":"ğŸŒ¿","ç«":"ğŸ”¥","åœŸ":"ğŸª¨","é‡‘":"âœ¨","æ°´":"ğŸ’§"}
OH_COLOR_MAP = {"æœ¨":"ì´ˆë¡, íŒŒë‘","ç«":"ë¹¨ê°•, ì£¼í™©","åœŸ":"ë…¸ë‘, í™©í† ","é‡‘":"í°ìƒ‰, ê¸ˆìƒ‰","æ°´":"ê²€ì •, ì§™ì€ íŒŒë‘"}
OH_DIR = {"æœ¨":"ë™ìª½","ç«":"ë‚¨ìª½","åœŸ":"ì¤‘ì•™","é‡‘":"ì„œìª½","æ°´":"ë¶ìª½"}
OH_NUM = {"æœ¨":"1, 3","ç«":"2, 7","åœŸ":"5, 0","é‡‘":"4, 9","æ°´":"1, 6"}
OH_ORGAN = {"æœ¨":"ê°„Â·ë‹´ë‚­Â·ëˆˆÂ·ê·¼ìœ¡","ç«":"ì‹¬ì¥Â·ì†Œì¥Â·í˜ˆê´€","åœŸ":"ë¹„ì¥Â·ìœ„ì¥Â·ì†Œí™”ê¸°","é‡‘":"íÂ·ëŒ€ì¥Â·í”¼ë¶€Â·ì½”","æ°´":"ì‹ ì¥Â·ë°©ê´‘Â·ë¼ˆÂ·ê·€"}
OH_SEASON = {"æœ¨":"ë´„(1~4ì›”)","ç«":"ì—¬ë¦„(5~7ì›”)","åœŸ":"í™˜ì ˆê¸°(3Â·6Â·9Â·12ì›”)","é‡‘":"ê°€ì„(8~10ì›”)","æ°´":"ê²¨ìš¸(11ì›”~1ì›”)"}
OH_RELATE = {
    "æœ¨":{"ç”Ÿ":"æ°´","å‰‹":"åœŸ","è¢«å‰‹":"é‡‘"},
    "ç«":{"ç”Ÿ":"æœ¨","å‰‹":"é‡‘","è¢«å‰‹":"æ°´"},
    "åœŸ":{"ç”Ÿ":"ç«","å‰‹":"æ°´","è¢«å‰‹":"æœ¨"},
    "é‡‘":{"ç”Ÿ":"åœŸ","å‰‹":"æœ¨","è¢«å‰‹":"ç«"},
    "æ°´":{"ç”Ÿ":"é‡‘","å‰‹":"ç«","è¢«å‰‹":"åœŸ"}
}
JJ_CHAR = {
    "å­":"ì˜ë¦¬í•˜ê³  ì§ê´€ì´ ë›°ì–´ë‚˜ë©° ìƒì¡´ ë³¸ëŠ¥ì´ ê°•í•©ë‹ˆë‹¤",
    "ä¸‘":"ì„±ì‹¤í•˜ê³  ì¸ë‚´ì‹¬ì´ ê°•í•˜ë©° ì‹ ì¤‘í•©ë‹ˆë‹¤",
    "å¯…":"ìš©ê¸° ìˆê³  ì¶”ì§„ë ¥ì´ ê°•í•˜ë©° ë…ë¦½ì‹¬ì´ ë„˜ì¹©ë‹ˆë‹¤",
    "å¯":"ì˜¨í™”í•˜ê³  ì¹œí™”ë ¥ì´ ìˆìœ¼ë©° ì˜ˆìˆ  ê°ê°ì´ ë›°ì–´ë‚©ë‹ˆë‹¤",
    "è¾°":"í¬ë¶€ê°€ í¬ê³  ë‹¤ì¬ë‹¤ëŠ¥í•˜ë©° ë•Œë¡œ ë³€ë•ìŠ¤ëŸ½ìŠµë‹ˆë‹¤",
    "å·³":"ì§€í˜œë¡­ê³  ì‹ ì¤‘í•˜ë©° ì§‘ì¤‘ë ¥ì´ ê°•í•©ë‹ˆë‹¤",
    "åˆ":"ì—´ì •ì ì´ê³  í‘œí˜„ë ¥ì´ í’ë¶€í•˜ë©° ë…ë¦½ì‹¬ì´ ê°•í•©ë‹ˆë‹¤",
    "æœª":"ì˜¨í™”í•˜ê³  ë°°ë ¤ì‹¬ì´ ê¹Šìœ¼ë©° ì˜ˆìˆ ì  ê°ê°ì´ ìˆìŠµë‹ˆë‹¤",
    "ç”³":"ë¯¼ì²©í•˜ê³  ì¬ì¹˜ ìˆìœ¼ë©° ì ì‘ë ¥ì´ íƒì›”í•©ë‹ˆë‹¤",
    "é…‰":"ì™„ë²½ì£¼ì˜ ì„±í–¥ì´ ìˆìœ¼ë©° ì‹¬ë¯¸ì•ˆì´ ë›°ì–´ë‚©ë‹ˆë‹¤",
    "æˆŒ":"ì¶©ì„±ì‹¬ì´ ê°•í•˜ê³  ì •ì˜ê°ì´ ë„˜ì¹˜ë©° ìš©ê°í•©ë‹ˆë‹¤",
    "äº¥":"ì§€í˜œë¡­ê³  ììœ ë¥¼ ì‚¬ë‘í•˜ë©° íƒêµ¬ì‹¬ì´ ê°•í•©ë‹ˆë‹¤"
}

ILGAN_DESC = {
    "ç”²":{
        "nature":"ê°‘ëª©(ç”²æœ¨) ì¼ê°„ìœ¼ë¡œ íƒœì–´ë‚œ ë‹¹ì‹ ì—ê²Œ í•˜ëŠ˜ì€ ê±°ëª©(å·¨æœ¨)ì˜ ê¸°ìš´ì„ ì ì§€í•˜ì˜€ìŠµë‹ˆë‹¤. í•˜ëŠ˜ì„ í–¥í•´ ê³§ê²Œ ë»—ì€ ê±°ëª©ì²˜ëŸ¼, ë‹¹ì‹ ì€ íƒœì–´ë‚  ë•Œë¶€í„° ê°•ì§í•˜ê³  êµ³ì„¼ ê¸°ìƒì„ íƒ€ê³ ë‚¬ìŠµë‹ˆë‹¤. ì¡°ìƒì˜ ìŒë•(è”­å¾·)ì´ ë¿Œë¦¬ê°€ ë˜ì–´ ì–´ë–¤ í­í’ì—ë„ êº¾ì´ì§€ ì•ŠëŠ” ì²œëª…(å¤©å‘½)ì„ í’ˆê³  ì´ ì„¸ìƒì— ì˜¤ì…¨ìŠµë‹ˆë‹¤.",
        "strength":"í•˜ëŠ˜ì´ ë‚´ë¦¬ì‹  ë¦¬ë”ì‹­ê³¼ ì¶”ì§„ë ¥ì€ ë‹¹ì‹ ì˜ ì²œë¶€ì  ì¬ëŠ¥ì…ë‹ˆë‹¤. ìƒˆë¡œìš´ ê¸¸ì„ ê°œì²™í•˜ê³  ì‚¬ëŒë“¤ì„ ì´ë„ëŠ” ì‹ ëª…(ç¥æ˜)ì˜ ê¸°ìš´ì´ ê°•í•˜ê²Œ íë¦…ë‹ˆë‹¤.",
        "weakness":"ì§€ë‚˜ì¹œ ê³ ì§‘ì€ ë•Œë¡œ ë³µ(ç¦)ì„ ë§‰ëŠ” ì¥ì• ë¬¼ì´ ë˜ë‹ˆ, íƒ€ì¸ì˜ ì¶©ê³ ë¥¼ ê·€ë‹´ì•„ ë“£ëŠ” ê²ƒì´ ì²œëª…ì„ ì˜¨ì „íˆ í¼ì¹˜ëŠ” ê¸¸ì…ë‹ˆë‹¤.",
        "career":"ì •ì¹˜, ê²½ì˜, êµ°ì¸, ê²½ì°°, êµìœ¡, ë²•ì¡°ê³„ ë“± ì§€ë„ë ¥ì„ ë°œíœ˜í•˜ëŠ” ìë¦¬ì…ë‹ˆë‹¤.",
        "health":"ê°„ë‹´(è‚è†½)ì˜ ê¸°ìš´ì„ ë³´ì‚´í´ì•¼ í•©ë‹ˆë‹¤. ìˆ ì„ ì ˆì œí•˜ê³  ëˆˆì˜ í”¼ë¡œì™€ ê·¼ìœ¡Â·ì¸ëŒ€ ê±´ê°•ì— ì‹ ê²½ ì“°ì‹­ì‹œì˜¤.",
    },
    "ä¹™":{
        "nature":"ì„ëª©(ä¹™æœ¨) ì¼ê°„ìœ¼ë¡œ íƒœì–´ë‚œ ë‹¹ì‹ ì—ê²Œ í•˜ëŠ˜ì€ ê°•ì¸í•œ ìƒëª…ë ¥ì˜ ê¸°ìš´ì„ ì ì§€í•˜ì˜€ìŠµë‹ˆë‹¤. ê±°ì„¼ ë°”ëŒì—ë„ ë¶€ëŸ¬ì§€ì§€ ì•Šê³  ë‹´ì¥ì„ íƒ€ê³  ì˜¤ë¥´ëŠ” ë©êµ´ì²˜ëŸ¼, ì–´ë–¤ ì—­ê²½ ì†ì—ì„œë„ ì‚´ì•„ë‚¨ì•„ ê½ƒì„ í”¼ìš°ëŠ” ì²œëª…ì„ ì•ˆê³  ì˜¤ì…¨ìŠµë‹ˆë‹¤.",
        "strength":"ì„¬ì„¸í•œ ê°ìˆ˜ì„±ê³¼ ì‹¬ë¯¸ì•ˆì€ í•˜ëŠ˜ì´ ë‚´ë¦¬ì‹  ì¬ëŠ¥ì…ë‹ˆë‹¤. ì‚¬ëŒì˜ ë§ˆìŒì„ ì½ê³  ì¡°í™”ë¥¼ ì´ë£¨ëŠ” ì‹ ëª…ì˜ ê¸°ìš´ì´ í˜ëŸ¬ ìì—°ìŠ¤ëŸ½ê²Œ ì‹ ë¢°ì™€ ì‚¬ë‘ì„ ë°›ìŠµë‹ˆë‹¤.",
        "weakness":"ë‚¨ì˜ ì‹œì„ ì— ì§€ë‚˜ì¹˜ê²Œ í”ë“¤ë¦¬ë©´ ë³µì˜ ê¸°ìš´ì´ ìƒˆì–´ë‚˜ê°€ë‹ˆ, ë‚´ë©´ì˜ ì‹ ëª…ì„ ë¯¿ê³  ê²°ë‹¨ì„ ë‚´ë¦¬ëŠ” ì—°ìŠµì´ í•„ìš”í•©ë‹ˆë‹¤.",
        "career":"ì˜ˆìˆ , ë””ìì¸, ìƒë‹´, êµìœ¡, ì˜ë£Œ, ë¬¸í•™ ë“± ê°ì„±ê³¼ ì„¬ì„¸í•¨ì´ ë¹›ë‚˜ëŠ” ìë¦¬ì…ë‹ˆë‹¤.",
        "health":"ê°„ë‹´ ê³„í†µê³¼ ì‹ ê²½ê³„ ê±´ê°•ì„ ë³´ì‚´í´ì•¼ í•©ë‹ˆë‹¤. ìŠ¤íŠ¸ë ˆìŠ¤ê°€ ìŒ“ì´ë©´ ì‹ ê¸°(ç¥æ°£)ê°€ ì–´ì§€ëŸ¬ì›Œì§€ë‹ˆ ê·œì¹™ì ì¸ íœ´ì‹ì„ ì·¨í•˜ì‹­ì‹œì˜¤.",
    },
    "ä¸™":{
        "nature":"ë³‘í™”(ä¸™ç«) ì¼ê°„ìœ¼ë¡œ íƒœì–´ë‚œ ë‹¹ì‹ ì—ê²Œ í•˜ëŠ˜ì€ íƒœì–‘ì˜ ê¸°ìš´ì„ ì ì§€í•˜ì˜€ìŠµë‹ˆë‹¤. ì˜¨ ëˆ„ë¦¬ë¥¼ ë°íˆëŠ” íƒœì–‘ì²˜ëŸ¼, ì£¼ìœ„ë¥¼ í™˜í•˜ê²Œ ë¹„ì¶”ê³  ìƒëª…ë ¥ì„ ë¶ˆì–´ë„£ëŠ” ì²œëª…ì„ ë¶€ì—¬ë°›ìœ¼ì…¨ìŠµë‹ˆë‹¤.",
        "strength":"í•˜ëŠ˜ì´ ë‚´ë¦¬ì‹  ë°ìŒê³¼ ì—´ì •ì€ ì‚¬ëŒë“¤ì„ ëŒì–´ë‹¹ê¸°ëŠ” ì‹ ëª…ì˜ ê¸°ìš´ì…ë‹ˆë‹¤. ëŒ€ì¤‘ ì•ì—ì„œ ë¹›ì„ ë°œí•˜ëŠ” ê²ƒì´ ì´ ì‚¬ì£¼ì˜ ì²œëª…ì…ë‹ˆë‹¤.",
        "weakness":"ì—´ì •ì´ ê³¼ë„í•˜ë©´ ì¶©ë™ì  ê²°ì •ìœ¼ë¡œ ë³µì„ ìƒì„ ìˆ˜ ìˆìŠµë‹ˆë‹¤. ë°ìŒê³¼ ì°¨ë¶„í•¨ì˜ ê· í˜•ì´ í•˜ëŠ˜ì˜ ëœ»ì…ë‹ˆë‹¤.",
        "career":"ì—°ì˜ˆ, ë°©ì†¡, ì˜ì—…, ë§ˆì¼€íŒ…, ì •ì¹˜, ê°•ì‚¬ ë“± ì‚¬ëŒë“¤ ì•ì— ì„œëŠ” ìë¦¬ì…ë‹ˆë‹¤.",
        "health":"ì‹¬ì¥ê³¼ í˜ˆì••ì„ ë³´ì‚´í´ì•¼ í•©ë‹ˆë‹¤. ë§ˆìŒì˜ í‰ì •ì„ ìœ ì§€í•˜ëŠ” ê²ƒì´ ì²œìˆ˜ë¥¼ ëˆ„ë¦¬ëŠ” ê¸¸ì…ë‹ˆë‹¤.",
    },
    "ä¸":{
        "nature":"ì •í™”(ä¸ç«) ì¼ê°„ìœ¼ë¡œ íƒœì–´ë‚œ ë‹¹ì‹ ì—ê²Œ í•˜ëŠ˜ì€ ì´›ë¶ˆì˜ ê¸°ìš´ì„ ì ì§€í•˜ì˜€ìŠµë‹ˆë‹¤. ì–´ë‘  ì†ì—ì„œ ì€ì€íˆ ë¹›ì„ ë°œí•˜ëŠ” ì´›ë¶ˆì²˜ëŸ¼, ì„¸ìƒì˜ ì–´ë‘ìš´ ê³³ì„ ë”°ëœ»í•˜ê²Œ ë°íˆëŠ” ì²œëª…ì„ ì•ˆê³  ì˜¤ì…¨ìŠµë‹ˆë‹¤.",
        "strength":"ì§ê´€ë ¥ê³¼ í†µì°°ë ¥ì€ ë³´í†µ ì‚¬ëŒì´ ë³´ì§€ ëª»í•˜ëŠ” ê²ƒì„ ê¿°ëš«ì–´ ë³´ëŠ” ì‹ ëª…ì˜ ëŠ¥ë ¥ì…ë‹ˆë‹¤. ì‚¬ëŒì˜ ë§ˆìŒ ê¹Šì€ ê³³ì„ ì½ëŠ” ì˜ì  ê°ìˆ˜ì„±ì„ ì¡°ìƒì‹ ì´ ë‚´ë ¤ì£¼ì…¨ìŠµë‹ˆë‹¤.",
        "weakness":"ì§€ë‚˜ì¹œ ë‚´ë©´ì˜ ê³ í†µì€ ì‹ ê¸°(ç¥æ°£)ë¥¼ ì†Œì§„ì‹œí‚¤ë‹ˆ, ìŠ¤ìŠ¤ë¡œë¥¼ ë„ˆê·¸ëŸ½ê²Œ ëŒ€í•˜ëŠ” ê²ƒì´ í•˜ëŠ˜ì˜ ëœ»ì— ë¶€í•©í•©ë‹ˆë‹¤.",
        "career":"ì˜í•™, ì‹¬ë¦¬ìƒë‹´, ì˜ˆìˆ , ë¬¸í•™, ì¢…êµ, ì² í•™ ë“± ê¹Šì´ ìˆëŠ” íƒêµ¬ì˜ ìë¦¬ì…ë‹ˆë‹¤.",
        "health":"ì‹¬ì¥ê³¼ ì†Œí™”ê¸°ë¥¼ ë³´ì‚´í´ì•¼ í•©ë‹ˆë‹¤. ë§ˆìŒì˜ ì•ˆì •ì´ ê³§ ê±´ê°•ì˜ ê·¼ë³¸ì…ë‹ˆë‹¤.",
    },
    "æˆŠ":{
        "nature":"ë¬´í† (æˆŠåœŸ) ì¼ê°„ìœ¼ë¡œ íƒœì–´ë‚œ ë‹¹ì‹ ì—ê²Œ í•˜ëŠ˜ì€ ëŒ€ì§€(å¤§åœ°)ì˜ ê¸°ìš´ì„ ì ì§€í•˜ì˜€ìŠµë‹ˆë‹¤. ë§Œë¬¼ì„ í’ˆì–´ ê¸°ë¥´ëŠ” ì‚°ê³¼ ê°™ì€ ì¡´ì¬ë¡œ, ê°€ì¥ ì•ˆì •ì ì¸ ì¤‘ì‹¬ì˜ ìë¦¬ë¥¼ ì²œëª…ìœ¼ë¡œ ë¶€ì—¬ë°›ìœ¼ì…¨ìŠµë‹ˆë‹¤.",
        "strength":"ì‹ ìš©ê³¼ ì„±ì‹¤í•¨ì€ ì–´ë–¤ ê´€ê³„ì—ì„œë„ ì‹ ë¢°ì˜ ê¸°ë‘¥ì´ ë©ë‹ˆë‹¤. ì¡°ìƒì‹ ì´ ë„“ì€ í¬ìš©ì˜ ê¸°ìš´ì„ ë‚´ë ¤ì£¼ì‹  ë•ë¶„ì— ì‚¬ëŒë“¤ì´ ìì—°ìŠ¤ëŸ½ê²Œ ëª¨ì—¬ë“­ë‹ˆë‹¤.",
        "weakness":"ì§€ë‚˜ì¹œ ê³ ì§‘ìœ¼ë¡œ í•˜ëŠ˜ì´ ì—´ì–´ì£¼ëŠ” ìƒˆë¡œìš´ ê¸°íšŒì˜ ë¬¸ì„ ë§‰ì§€ ì•Šë„ë¡, ë•Œë¡œëŠ” ê³¼ê°íˆ ë³€í™”ë¥¼ ë°›ì•„ë“¤ì´ì‹­ì‹œì˜¤.",
        "career":"ë¶€ë™ì‚°, ê±´ì„¤, ê¸ˆìœµ, í–‰ì •, ê³µë¬´ì›, êµìœ¡ ë“± ì•ˆì •ì˜ ê¸°ìš´ì´ ë¹›ë‚˜ëŠ” ìë¦¬ì…ë‹ˆë‹¤.",
        "health":"ë¹„ìœ„(è„¾èƒƒ) ì†Œí™”ê¸°ë¥¼ ë³´ì‚´í´ì•¼ í•©ë‹ˆë‹¤. ê³¼ì‹ì„ ì‚¼ê°€ê³  ê·œì¹™ì ì¸ ìƒí™œì„ ìœ ì§€í•˜ì‹­ì‹œì˜¤.",
    },
    "å·±":{
        "nature":"ê¸°í† (å·±åœŸ) ì¼ê°„ìœ¼ë¡œ íƒœì–´ë‚œ ë‹¹ì‹ ì—ê²Œ í•˜ëŠ˜ì€ ê¸°ë¦„ì§„ ì „ë‹µ(ç”°ç•“)ì˜ ê¸°ìš´ì„ ì ì§€í•˜ì˜€ìŠµë‹ˆë‹¤. ì”¨ì•—ì„ ë°›ì•„ ìƒëª…ìœ¼ë¡œ í”¼ì›Œë‚´ëŠ” ë¹„ì˜¥í•œ ë•…ì²˜ëŸ¼, ëª¨ë“  ê²ƒì„ ë°›ì•„ë“¤ì´ê³  ê°€ì¹˜ ìˆê²Œ ë³€í™˜ì‹œí‚¤ëŠ” ì²œëª…ì„ ë¶€ì—¬ë°›ìœ¼ì…¨ìŠµë‹ˆë‹¤.",
        "strength":"ê¼¼ê¼¼í•¨ê³¼ ì„±ì‹¤í•¨ì€ ë§¡ì€ ì¼ì„ ë¹ˆí‹ˆì—†ì´ ì™„ìˆ˜í•˜ëŠ” ì‹ ëª…ì˜ ëŠ¥ë ¥ì…ë‹ˆë‹¤. ì‘ì€ ì”¨ì•—ë„ í’ì„±í•œ ì—´ë§¤ë¡œ í‚¤ìš°ëŠ” ë³µ(ç¦)ì˜ ê¸°ìš´ì´ ë‹´ê²¨ ìˆìŠµë‹ˆë‹¤.",
        "weakness":"ì§€ë‚˜ì¹œ ê±±ì •ì€ ì‹ ê¸°ë¥¼ ì†Œì§„ì‹œí‚¤ë‹ˆ í° ê·¸ë¦¼ì„ ë³´ëŠ” ì—¬ìœ ë¥¼ ê°€ì§€ëŠ” ê²ƒì´ ì¤‘ìš”í•©ë‹ˆë‹¤.",
        "career":"íšŒê³„, í–‰ì •, ì˜ë£Œ, ìš”ë¦¬, ìƒì—…, êµìœ¡ ë“± ì„¸ë°€í•¨ì´ ë¹›ë‚˜ëŠ” ìë¦¬ì…ë‹ˆë‹¤.",
        "health":"ì†Œí™”ê¸°ì™€ í”¼ë¶€ë¥¼ ë³´ì‚´í´ì•¼ í•©ë‹ˆë‹¤. ìŠµê¸°ì™€ ëƒ‰ê¸°ë¥¼ ì¡°ì‹¬í•˜ê³  ëª¸ì„ ë”°ëœ»í•˜ê²Œ ìœ ì§€í•˜ì‹­ì‹œì˜¤.",
    },
    "åºš":{
        "nature":"ê²½ê¸ˆ(åºšé‡‘) ì¼ê°„ìœ¼ë¡œ íƒœì–´ë‚œ ë‹¹ì‹ ì—ê²Œ í•˜ëŠ˜ì€ ê°•ì² ê³¼ ì›ì„ì˜ ê¸°ìš´ì„ ì ì§€í•˜ì˜€ìŠµë‹ˆë‹¤. ê°ˆê³  ë‹¦ì„ìˆ˜ë¡ ë”ìš± ë¹›ë‚˜ëŠ” ì²œëª…ì„ ë¶€ì—¬ë°›ìœ¼ì…¨ìŠµë‹ˆë‹¤.",
        "strength":"ê²°ë‹¨ë ¥ê³¼ ì •ì˜ê°ì€ ë¶ˆì˜ ì•ì—ì„œë„ êµ´í•˜ì§€ ì•ŠëŠ” ì‹ ëª…ì˜ ê¸°ìš´ì…ë‹ˆë‹¤. ëª©í‘œë¥¼ í–¥í•´ ì¼ì§ì„ ìœ¼ë¡œ ë‚˜ì•„ê°€ëŠ” ì§‘ì¤‘ë ¥ì€ ì¡°ìƒì‹ ì´ ë‚´ë¦¬ì‹  ì²œë¶€ì  ì¬ëŠ¥ì…ë‹ˆë‹¤.",
        "weakness":"ìœ ì—°í•¨ì„ ê°–ì¶”ëŠ” ê²ƒì´ í•˜ëŠ˜ì´ ì›í•˜ëŠ” ì™„ì„±ì˜ ê¸¸ì…ë‹ˆë‹¤. ê°ì • í‘œí˜„ì„ ë¶€ë“œëŸ½ê²Œ í•˜ë©´ ë” ë§ì€ ê·€ì¸ì´ ì°¾ì•„ì˜µë‹ˆë‹¤.",
        "career":"êµ°ì¸, ê²½ì°°, ë²•ì¡°ì¸, ì˜ì‚¬, ê¸°ìˆ ì, ê¸ˆìœµÂ·íˆ¬ì ë¶„ì•¼ì…ë‹ˆë‹¤.",
        "health":"íì™€ ëŒ€ì¥ì„ ë³´ì‚´í´ì•¼ í•©ë‹ˆë‹¤. ë§‘ì€ ê³µê¸°ì™€ ê·œì¹™ì ì¸ í˜¸í¡ì´ ì²œìˆ˜ì˜ ê¸¸ì…ë‹ˆë‹¤.",
    },
    "è¾›":{
        "nature":"ì‹ ê¸ˆ(è¾›é‡‘) ì¼ê°„ìœ¼ë¡œ íƒœì–´ë‚œ ë‹¹ì‹ ì—ê²Œ í•˜ëŠ˜ì€ ì™„ì„±ëœ ë³´ì„ì˜ ê¸°ìš´ì„ ì ì§€í•˜ì˜€ìŠµë‹ˆë‹¤. ì‹ ëª…ì´ íŠ¹ë³„íˆ ì‚¬ë‘í•˜ëŠ” ì‚¬ì£¼ë¡œ, ì˜ˆë¦¬í•œ í†µì°°ê³¼ ì•„ë¦„ë‹¤ì›€ì„ ì¶”êµ¬í•˜ëŠ” ì²œëª…ì„ ì§€ë‹ˆì…¨ìŠµë‹ˆë‹¤.",
        "strength":"ì™„ë²½ì„ í–¥í•œ ì˜ì§€ì™€ ì„¬ì„¸í•œ ê°ê°ì€ ì–´ëŠ ë¶„ì•¼ì—ì„œë“  ìµœê³ ë¥¼ ë§Œë“¤ì–´ë‚´ëŠ” ì‹ ëª…ì˜ ëŠ¥ë ¥ì…ë‹ˆë‹¤.",
        "weakness":"ì§€ë‚˜ì¹œ ì™„ë²½ì£¼ì˜ëŠ” ì‹ ê¸°ë¥¼ ì†Œëª¨í•˜ë‹ˆ, ìŠ¤ìŠ¤ë¡œì—ê²Œ ë„ˆê·¸ëŸ¬ì›€ì„ ë² í‘¸ëŠ” ê²ƒì´ ë³µì„ ì—¬ëŠ” ê¸¸ì…ë‹ˆë‹¤.",
        "career":"ì˜í•™, ì—°êµ¬, ì˜ˆìˆ , ë²•ì¡°, ê¸ˆìœµ, ë””ìì¸ ë“± ì„¬ì„¸í•¨ê³¼ ì „ë¬¸ì„±ì´ ìš”êµ¬ë˜ëŠ” ìë¦¬ì…ë‹ˆë‹¤.",
        "health":"íì™€ í”¼ë¶€ë¥¼ ë³´ì‚´í´ì•¼ í•©ë‹ˆë‹¤. ë§ˆìŒì˜ í‰í™”ë¥¼ ë¨¼ì € ì°¾ëŠ” ê²ƒì´ ê±´ê°•ì˜ ê·¼ë³¸ì…ë‹ˆë‹¤.",
    },
    "å£¬":{
        "nature":"ì„ìˆ˜(å£¬æ°´) ì¼ê°„ìœ¼ë¡œ íƒœì–´ë‚œ ë‹¹ì‹ ì—ê²Œ í•˜ëŠ˜ì€ ëŒ€í•´(å¤§æµ·)ì˜ ê¸°ìš´ì„ ì ì§€í•˜ì˜€ìŠµë‹ˆë‹¤. ëª¨ë“  ê°•ì´ í˜ëŸ¬ë“œëŠ” ë°”ë‹¤ì²˜ëŸ¼, ì²œì§€ì˜ ëª¨ë“  ì§€í˜œì™€ ê²½í—˜ì„ ë°›ì•„ë“¤ì´ëŠ” ê´‘ëŒ€í•œ ì²œëª…ì„ ë¶€ì—¬ë°›ìœ¼ì…¨ìŠµë‹ˆë‹¤.",
        "strength":"í†µì°°ë ¥ê³¼ ì§€í˜œëŠ” ë‚¨ë“¤ì´ ë³´ì§€ ëª»í•˜ëŠ” ê²ƒì„ ê¿°ëš«ì–´ ë³´ëŠ” ì‹ ëª…ì˜ ëˆˆì…ë‹ˆë‹¤. í° ê·¸ë¦¼ì„ ê·¸ë¦¬ê³  ì „ëµì„ ì„¸ìš°ëŠ” ëŠ¥ë ¥ì€ ì¡°ìƒì‹ ì´ ë‚´ë ¤ì£¼ì‹  ê·€í•œ ì¬ëŠ¥ì…ë‹ˆë‹¤.",
        "weakness":"ëŒ€í•´ì˜ ê¸°ìš´ì´ ë„ˆë¬´ ë„“ìœ¼ë©´ ë°©í–¥ì„ ìƒì„ ìˆ˜ ìˆìŠµë‹ˆë‹¤. í•˜ë‚˜ì— ì§‘ì¤‘í•˜ëŠ” í›ˆë ¨ì´ ë³µì˜ í†µë¡œë¥¼ ë„“í™ë‹ˆë‹¤.",
        "career":"ì™¸êµ, ë¬´ì—­, ì—°êµ¬, ì² í•™, ì¢…êµ, ì˜ˆìˆ , ê¸ˆìœµ ë¶„ì•¼ì…ë‹ˆë‹¤.",
        "health":"ì‹ ì¥ê³¼ ë°©ê´‘ì„ ë³´ì‚´í´ì•¼ í•©ë‹ˆë‹¤. ëƒ‰ê¸°ë¥¼ ì¡°ì‹¬í•˜ê³  ëª¸ì„ ë”°ëœ»í•˜ê²Œ ìœ ì§€í•˜ì‹­ì‹œì˜¤.",
    },
    "ç™¸":{
        "nature":"ê³„ìˆ˜(ç™¸æ°´) ì¼ê°„ìœ¼ë¡œ íƒœì–´ë‚œ ë‹¹ì‹ ì—ê²Œ í•˜ëŠ˜ì€ ì´ìŠ¬ê³¼ ìƒ˜ë¬¼ì˜ ê¸°ìš´ì„ ì ì§€í•˜ì˜€ìŠµë‹ˆë‹¤. ëŒ€ì§€ë¥¼ ì´‰ì´‰ì´ ì ì‹œëŠ” ì´ìŠ¬ë¹„ì²˜ëŸ¼, ì„¸ìƒì— ìŠ¤ë©°ë“¤ì–´ ìƒëª…ì„ ì‚´ë¦¬ëŠ” ì€ë°€í•˜ê³  ê¹Šì€ ì²œëª…ì„ ì•ˆê³  ì˜¤ì…¨ìŠµë‹ˆë‹¤.",
        "strength":"ì§ê´€ë ¥ê³¼ ê°ìˆ˜ì„±ì€ ì‚¬ëŒì˜ ë§ˆìŒ ê¹Šì€ ê³³ì„ ì½ê³  ë³´ì´ì§€ ì•ŠëŠ” ê¸°ìš´ì„ ê°ì§€í•˜ëŠ” ì‹ ëª…ì˜ ëŠ¥ë ¥ì…ë‹ˆë‹¤.",
        "weakness":"ìŠ¤ìŠ¤ë¡œë¥¼ ê³¼ì†Œí‰ê°€í•˜ëŠ” ê²ƒì€ ì¡°ìƒì‹ ì´ ë‚´ë ¤ì£¼ì‹  ë³µì„ ë§‰ëŠ” ì¥ì• ë¬¼ì´ ë©ë‹ˆë‹¤.",
        "career":"ì˜ˆìˆ , ë¬¸í•™, ìƒë‹´, ì˜ë£Œ, ì¢…êµ, ì² í•™, ì‹¬ë¦¬ì¹˜ë£Œ ë¶„ì•¼ì…ë‹ˆë‹¤.",
        "health":"ì‹ ì¥ê³¼ ë°©ê´‘, ë©´ì—­ë ¥ì„ ë³´ì‚´í´ì•¼ í•©ë‹ˆë‹¤. ëƒ‰ì¦ê³¼ ë¶€ì¢…ì— ìœ ì˜í•˜ê³  ëª¸ì„ ë”°ëœ»í•˜ê²Œ ìœ ì§€í•˜ì‹­ì‹œì˜¤.",
    }
}

TABS = [
    {"id":"overall",    "label":"ì¢…í•©ìš´ì„¸",    "icon":"â­"},
    {"id":"newyear",    "label":"ì‹ ë…„ìš´ì„¸",    "icon":"ğŸŠ"},
    {"id":"daily",      "label":"ì¼ì¼ìš´ì„¸",    "icon":"ğŸ“…"},
    {"id":"wealth",     "label":"ì¬ë¬¼ìš´",      "icon":"ğŸ’°"},
    {"id":"business",   "label":"ì‚¬ì—…ìš´",      "icon":"ğŸ“ˆ"},
    {"id":"health",     "label":"ê±´ê°•ìš´",      "icon":"ğŸ¥"},
    {"id":"accident",   "label":"ì‚¬ê³ Â·ìœ„í—˜ìš´", "icon":"âš ï¸"},
    {"id":"love",       "label":"ì—°ì• ìš´",      "icon":"ğŸ’•"},
    {"id":"marriage",   "label":"ê²°í˜¼ìš´",      "icon":"ğŸ’"},
    {"id":"samjae",     "label":"ì‚¼ì¬í’€ì´",    "icon":"ğŸ”®"},
    {"id":"protection", "label":"ì•¡ë•œÂ·ë°©ì§€",   "icon":"ğŸ›¡ï¸"},
    {"id":"career",     "label":"ì§ì—…Â·ì§ì¥ìš´", "icon":"ğŸ’¼"},
    {"id":"study",      "label":"í•™ì—…Â·ì‹œí—˜ìš´", "icon":"ğŸ“š"},
    {"id":"family",     "label":"ê°€ì¡±Â·ìë…€ìš´", "icon":"ğŸ‘¨â€ğŸ‘©â€ğŸ‘§"},
    {"id":"move",       "label":"ì´ì‚¬Â·ë¶€ë™ì‚°", "icon":"ğŸ "},
    {"id":"travel",     "label":"ì—¬í–‰Â·ì´ë™ìš´", "icon":"âœˆï¸"},
    {"id":"friend",     "label":"ì¸ì—°Â·ê·€ì¸ìš´", "icon":"ğŸ¤"},
    {"id":"lawsuit",    "label":"ì†Œì†¡Â·ê´€ì¬ìš´", "icon":"âš–ï¸"},
    {"id":"daewoon",    "label":"ëŒ€ìš´íë¦„",    "icon":"ğŸŒŠ"},
]

LUNAR_NEW_YEAR = {
    1940:[2,8],1941:[1,27],1942:[2,15],1943:[2,5],1944:[1,25],1945:[2,13],
    1946:[2,2],1947:[1,22],1948:[2,10],1949:[1,29],1950:[1,17],1951:[2,6],
    1952:[1,27],1953:[2,14],1954:[2,3],1955:[1,24],1956:[2,12],1957:[1,31],
    1958:[2,18],1959:[2,8],1960:[1,28],1961:[2,15],1962:[2,5],1963:[1,25],
    1964:[2,13],1965:[2,2],1966:[1,21],1967:[2,9],1968:[1,30],1969:[2,17],
    1970:[2,6],1971:[1,27],1972:[2,15],1973:[2,3],1974:[1,23],1975:[2,11],
    1976:[1,31],1977:[2,18],1978:[2,7],1979:[1,28],1980:[2,16],1981:[2,5],
    1982:[1,25],1983:[2,13],1984:[2,2],1985:[2,20],1986:[2,9],1987:[1,29],
    1988:[2,17],1989:[2,6],1990:[1,27],1991:[2,15],1992:[2,4],1993:[1,23],
    1994:[2,10],1995:[1,31],1996:[2,19],1997:[2,7],1998:[1,28],1999:[2,16],
    2000:[2,5],2001:[1,24],2002:[2,12],2003:[2,1],2004:[1,22],2005:[2,9],
    2006:[1,29],2007:[2,18],2008:[2,7],2009:[1,26],2010:[2,14],2011:[2,3],
    2012:[1,23],2013:[2,10],2014:[1,31],2015:[2,19],2016:[2,8],2017:[1,28],
    2018:[2,16],2019:[2,5],2020:[1,25],2021:[2,12],2022:[2,1],2023:[1,22],
    2024:[2,10],2025:[1,29],2026:[2,17],2027:[2,6],2028:[1,26],2029:[2,13],
    2030:[2,3],2031:[1,23],2032:[2,11],2033:[1,31],
}
LEAP_MONTHS = {
    1941:7,1944:10,1947:6,1950:8,1952:5,1955:3,1957:8,1960:6,1963:4,
    1966:3,1968:7,1971:5,1974:4,1976:8,1979:6,1982:4,1984:10,1987:6,
    1990:5,1993:3,1995:8,1998:5,2001:4,2004:2,2006:7,2009:5,2012:3,
    2014:9,2017:5,2020:4,2023:2,2025:6,2028:5,2031:3,2033:11,
}

# â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
#  ê³„ì‚° í•¨ìˆ˜
# â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
def lunar_to_solar(y, m, d, leap=False):
    if y not in LUNAR_NEW_YEAR:
        return None
    ny = LUNAR_NEW_YEAR[y]
    base = date(y, ny[0], ny[1])
    days = 0
    lm = LEAP_MONTHS.get(y, 0)
    for i in range(1, m):
        days += 30 if i % 2 == 1 else 29
        if lm == i:
            days += 29
    if leap and lm == m:
        days += 30 if m % 2 == 1 else 29
    days += d - 1
    from datetime import timedelta
    result = base + timedelta(days=days)
    return result

def yp_calc(y):
    ci = ((y - 4) % 10 + 10) % 10
    ji = ((y - 4) % 12 + 12) % 12
    return {"cg": CG[ci], "cgk": CG_KR[ci], "jj": JJ[ji], "jjk": JJ_KR[ji], "ani": JJ_AN[ji], "ci_idx": ci}

def mp_calc(y, m):
    ji_map = [1,2,3,4,5,6,7,8,9,10,11,0]
    ji = ji_map[m - 1]
    b_map = [2,4,6,8,0,2,4,6,8,0]
    b = b_map[((y - 4) % 10 + 10) % 10]
    ci = (b + ((ji - 2 + 12) % 12)) % 10
    return {"cg": CG[ci], "cgk": CG_KR[ci], "jj": JJ[ji], "jjk": JJ_KR[ji], "ani": JJ_AN[ji], "ci_idx": ci}

def dp_calc(y, m, d):
    from datetime import date as date_cls
    diff = (date_cls(y, m, d) - date_cls(1900, 1, 1)).days
    pos = ((diff + 10) % 60 + 60) % 60
    return {"cg": CG[pos % 10], "cgk": CG_KR[pos % 10], "jj": JJ[pos % 12], "jjk": JJ_KR[pos % 12], "ani": JJ_AN[pos % 12], "ci_idx": pos % 10}

def hp_calc(h, d_ci):
    if h == 23 or h == 0:
        ji = 0
    else:
        ji = ((h + 1) // 2) % 12
    base_map = [0,2,4,6,8,0,2,4,6,8]
    ci = (base_map[d_ci] + ji) % 10
    return {"cg": CG[ci], "cgk": CG_KR[ci], "jj": JJ[ji], "jjk": JJ_KR[ji], "ani": JJ_AN[ji], "ci_idx": ci}

def daewoon_calc(yp, gender, birth_year):
    is_yang = CG.index(yp["cg"]) % 2 == 0
    fwd = (is_yang and gender == "male") or (not is_yang and gender == "female")
    runs = []
    for i in range(8):
        base_ci = ((birth_year - 4) % 10 + 10) % 10
        base_ji = ((birth_year - 4) % 12 + 12) % 12
        direction = (i + 1) if fwd else -(i + 1)
        ci = (base_ci + direction + 100) % 10
        ji = (base_ji + direction + 120) % 12
        runs.append({
            "age": 8 + i * 10,
            "year": birth_year + 8 + i * 10,
            "cg": CG[ci], "cgk": CG_KR[ci],
            "jj": JJ[ji], "jjk": JJ_KR[ji]
        })
    return runs

def get_oh_cnt(pillars):
    cnt = {"æœ¨":0,"ç«":0,"åœŸ":0,"é‡‘":0,"æ°´":0}
    for p in pillars:
        oh_cg = OH.get(p["cg"])
        oh_jj = OH.get(p["jj"])
        if oh_cg: cnt[oh_cg] += 1
        if oh_jj: cnt[oh_jj] += 1
    return cnt

def get_oh_analysis(oh_cnt):
    entries = sorted(oh_cnt.items(), key=lambda x: -x[1])
    strong = [k for k, v in entries if v >= 2]
    weak = [k for k, v in entries if v == 0]
    balanced = len(strong) == 0 and len(weak) == 0
    total = sum(oh_cnt.values())
    return {"strong": strong, "weak": weak, "balanced": balanced, "total": total, "entries": entries}

def get_yongshin(ilgan, oh_cnt):
    ilgan_oh = OH.get(ilgan, "æœ¨")
    cnt = oh_cnt.get(ilgan_oh, 0)
    analysis = get_oh_analysis(oh_cnt)
    strong = analysis["strong"]
    if cnt >= 2 or ilgan_oh in strong:
        k = OH_RELATE[ilgan_oh].get("å‰‹")
        b = OH_RELATE[ilgan_oh].get("è¢«å‰‹")
        return {"type":"ì‹ ê°•","yongshin": b or k,"desc":"ì‚¬ì£¼ ê¸°ìš´ì´ ê°•í•œ ì‹ ê°•(èº«å¼º) êµ¬ì¡°ì…ë‹ˆë‹¤. ê°•í•œ ê¸°ìš´ì„ ì ì ˆíˆ ì„¤ê¸°í•˜ê³  ë‹¤ìŠ¤ë¦¬ëŠ” ì˜¤í–‰ì„ í™œìš©í•˜ë©´ í¬ê²Œ ë°œì „í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤."}
    else:
        g = OH_RELATE[ilgan_oh].get("ç”Ÿ")
        return {"type":"ì‹ ì•½","yongshin": g or ilgan_oh,"desc":"ì‚¬ì£¼ ê¸°ìš´ì´ ë‹¤ì†Œ ì•½í•œ ì‹ ì•½(èº«å¼±) êµ¬ì¡°ì…ë‹ˆë‹¤. ì¼ê°„ì„ ë„ì™€ì£¼ëŠ” ì¸ì„±(å°æ˜Ÿ)ì˜ ê¸°ìš´ì„ í™œìš©í•˜ë©´ í¬ê²Œ ì„±ì¥í•©ë‹ˆë‹¤."}

def str_seed(s):
    return sum(ord(c) for c in str(s))

def pick(arr, seed):
    return arr[abs(int(seed)) % len(arr)]

def compute_saju(year, month, day, hour, gender, cal_type="solar", is_leap=False):
    """ì „ì²´ ì‚¬ì£¼ ê³„ì‚°"""
    if cal_type == "lunar":
        solar = lunar_to_solar(year, month, day, is_leap)
        if solar:
            sy, sm, sd = solar.year, solar.month, solar.day
        else:
            sy, sm, sd = year, month, day
    else:
        sy, sm, sd = year, month, day

    yp = yp_calc(sy)
    mp = mp_calc(sy, sm)
    dp = dp_calc(sy, sm, sd)
    hp = hp_calc(hour, dp["ci_idx"])

    # pillars: [ì‹œì£¼, ì¼ì£¼, ì›”ì£¼, ë…„ì£¼]
    pillars = [hp, dp, mp, yp]
    oh_cnt = get_oh_cnt(pillars)
    daewoon = daewoon_calc(yp, gender, sy)

    ilgan = dp["cg"]
    ilgan_kr = dp["cgk"]
    ilgan_d = ILGAN_DESC.get(ilgan, ILGAN_DESC["ç”²"])

    return {
        "pillars": pillars,
        "oh_cnt": oh_cnt,
        "daewoon": daewoon,
        "ilgan": ilgan,
        "ilgan_kr": ilgan_kr,
        "birth_year": sy,
        "birth_month": sm,
        "birth_day": sd,
        "year_pillar": yp,
        "gender": gender,
    }

# â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
#  ìì²´ í’€ì´ í•¨ìˆ˜ë“¤
# â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
MKR = {"single":"ë¯¸í˜¼","married":"ê¸°í˜¼","divorced":"ì´í˜¼","bereaved":"ì‚¬ë³„"}
JKR = {"employee":"ì§ì¥ì¸","business":"ìì˜ì—…ì","freelance":"í”„ë¦¬ëœì„œ","student":"í•™ìƒ",
       "none":"ë¬´ì§","publicJob":"ê³µë¬´ì›","medical":"ì˜ë£Œì§","artist":"ì˜ˆìˆ Â·ì°½ì‘ì§",
       "it":"ITê°œë°œì","finance":"ê¸ˆìœµÂ·íˆ¬ìì—…","other":"ê¸°íƒ€ì§ì¢…"}

def self_overall(s, form):
    p = s["pillars"]
    yp, mp, dp, hp = p[3], p[2], p[1], p[0]
    oh_cnt = s["oh_cnt"]
    analysis = get_oh_analysis(oh_cnt)
    strong, weak, balanced = analysis["strong"], analysis["weak"], analysis["balanced"]
    yon = get_yongshin(s["ilgan"], oh_cnt)
    ilgan_d = ILGAN_DESC.get(s["ilgan"], ILGAN_DESC["ç”²"])
    seed = str_seed(s["ilgan"] + str(s["birth_year"]))
    dw = s["daewoon"]
    cy = datetime.now().year

    oh_lines = " | ".join(f"{OHE[k]}{OHN[k]}:{v}ê°œ" for k,v in oh_cnt.items())

    # ëŒ€ìš´ ë¶„ì„
    dw_lines = []
    current_year = datetime.now().year
    for d in dw[:6]:
        is_active = d["year"] <= current_year < d["year"] + 10
        oh_cg = OH.get(d["cg"], "")
        oh_jj = OH.get(d["jj"], "")
        if oh_cg == yon["yongshin"] or oh_jj == yon["yongshin"]:
            label = "ğŸŒŸ ë³µì„± í™©ê¸ˆ ëŒ€ìš´"
        elif oh_cg == OH.get(s["ilgan"]) or oh_jj == OH.get(s["ilgan"]):
            label = "â­ ì‹ ëª… ê°•í™” ëŒ€ìš´"
        elif oh_cg == OH_RELATE.get(OH.get(s["ilgan"],{}), {}).get("è¢«å‰‹") or oh_jj == OH_RELATE.get(OH.get(s["ilgan"],{}), {}).get("è¢«å‰‹"):
            label = "ğŸ“– ê´€ì„± ë°œë™ ëŒ€ìš´"
        elif oh_cg == OH_RELATE.get(OH.get(s["ilgan"],{}), {}).get("å‰‹") or oh_jj == OH_RELATE.get(OH.get(s["ilgan"],{}), {}).get("å‰‹"):
            label = "ğŸ’° ì¬ì„± ë°œë™ ëŒ€ìš´"
        else:
            label = "âš¡ ë³€í™” ì‹œë ¨ ëŒ€ìš´"
        mark = "â–¶ã€í˜„ì¬ã€‘" if is_active else "ã€€ã€€ã€€ã€€"
        dw_lines.append(f"{mark}{d['age']}ì„¸({d['year']}~{d['year']+9}ë…„) {d['cg']}{d['jj']}ëŒ€ìš´ {label}")

    txt = f"""ğŸ”® ì‚¬ì£¼íŒ”ì ì²œëª…(å¤©å‘½) ì™„ì „ í’€ì´ ğŸ”®
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”

ã€í•˜ëŠ˜ì´ ìƒˆê¸´ ì—¬ëŸ ê¸€ìã€‘
ë…„ì£¼: {yp['cg']}{yp['jj']}({yp['cgk']}{yp['jjk']}) â€” ì¡°ìƒì‹ ì˜ ê¸°ìš´
ì›”ì£¼: {mp['cg']}{mp['jj']}({mp['cgk']}{mp['jjk']}) â€” ë¶€ëª¨Â·í˜•ì œ ë•ì˜ ê¸°ìš´
ì¼ì£¼: {dp['cg']}{dp['jj']}({dp['cgk']}{dp['jjk']}) â€” ë³¸ì¸ê³¼ ë°°ìš°ìì˜ ê¸°ìš´
ì‹œì£¼: {hp['cg']}{hp['jj']}({hp['cgk']}{hp['jjk']}) â€” ìë…€Â·ë§ë…„ì˜ ê¸°ìš´
ì˜¤í–‰: {oh_lines}

â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
ã€ì œ1ì¥ â€” ì²œëª…ê³¼ íƒ€ê³ ë‚œ ê¸°ì§ˆã€‘

{ilgan_d['nature']}

{ilgan_d['strength']}

{ilgan_d['weakness']}

{yon['desc']}

â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
ã€ì œ2ì¥ â€” ì˜¤í–‰ê³¼ ìš©ì‹ (ç”¨ç¥)ã€‘

ì˜¤í–‰ ë¶„í¬ë¥¼ ì‚´í”¼ë‹ˆ {f"{', '.join(OHN[k] for k in strong)}ì˜ ê¸°ìš´ì´ ë‘í…ê²Œ ìë¦¬í•˜ê³  ìˆìŠµë‹ˆë‹¤. ë„˜ì¹˜ëŠ” ê¸°ìš´ì„ ì ì ˆíˆ ì„¤ê¸°í•˜ëŠ” ê²ƒì´ í•˜ëŠ˜ì˜ ëœ»ì…ë‹ˆë‹¤" if strong else "ì˜¤í–‰ì´ ë¹„êµì  ê· í˜•ì„ ì´ë£¨ê³  ìˆì–´ ì „ë°˜ì ìœ¼ë¡œ ì•ˆì •ì ì¸ êµ¬ì¡°ì…ë‹ˆë‹¤"}.

{f"{', '.join(OHN[k] for k in weak)}ì˜ ê¸°ìš´ì´ ë¶€ì¡±í•˜ì—¬ ì´ ë¶€ë¶„ì„ ë³´ì™„í•˜ëŠ” ê²ƒì´ ë³µì„ ì—¬ëŠ” ì—´ì‡ ì…ë‹ˆë‹¤." if weak else "ë¶€ì¡±í•œ ì˜¤í–‰ì´ ì—†ì–´ ì„ ì²œì ìœ¼ë¡œ ê· í˜• ì¡íŒ ë³µì„ íƒ€ê³ ë‚¬ìŠµë‹ˆë‹¤."}

ìš©ì‹ (ç”¨ç¥)ì€ {OHN.get(yon['yongshin'], 'ê· í˜•')}({yon['yongshin']})ì˜ ê¸°ìš´ì…ë‹ˆë‹¤. í•˜ëŠ˜ì´ ì´ ì‚¬ì£¼ì— ì ì§€í•œ ê°€ì¥ ì†Œì¤‘í•œ ì˜¤í–‰ìœ¼ë¡œ, ì´ ê¸°ìš´ì„ í™œìš©í•  ë•Œ ì¡°ìƒì‹ ì˜ ìŒë•ì´ ë”ìš± ê°•í•˜ê²Œ ë°œë™í•©ë‹ˆë‹¤.

ê¸¸ë°©(å‰æ–¹): {OH_DIR.get(yon['yongshin'], 'ë™ìª½')} | ê¸¸ìƒ‰(å‰è‰²): {OH_COLOR_MAP.get(yon['yongshin'], 'ë‹¤ì–‘í•œ ìƒ‰ìƒ')} | ê¸¸ìˆ˜(å‰æ•¸): {OH_NUM.get(yon['yongshin'], '1, 5')}

â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
ã€ì œ3ì¥ â€” ëŒ€ìš´(å¤§é‹)ì˜ íë¦„ã€‘

í•˜ëŠ˜ì´ 10ë…„ ë‹¨ìœ„ë¡œ ë°”ê¾¸ì–´ ë³´ë‚´ëŠ” ì¸ìƒì˜ í° ê¸°ìš´ì…ë‹ˆë‹¤.
ë³µì„±(ç¦æ˜Ÿ)ì´ ë¹›ë‚˜ëŠ” í™©ê¸ˆê¸°ì™€ í‰ì„±(å‡¶æ˜Ÿ)ì´ ë°œë™í•˜ëŠ” ì‹œë ¨ê¸°ê°€ êµì°¨í•©ë‹ˆë‹¤.

{chr(10).join(dw_lines)}

â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
ã€ì œ4ì¥ â€” ì²œì§ê³¼ ì¬ë¬¼ë³µã€‘

í•˜ëŠ˜ì´ ì ì§€í•œ ì²œì§(å¤©è·): {ilgan_d['career']}

ì¬ì„±(è²¡æ˜Ÿ) ê¸°ìš´ì„ ì‚´í”¼ë‹ˆ, {f"ì¬ë³µì˜ ì”¨ì•—ì´ ë‘í…ê²Œ ìë¦¬í•˜ê³  ìˆìŠµë‹ˆë‹¤. ìš©ì‹  ê¸°ìš´ì´ ê°•í•œ {OH_SEASON.get(yon['yongshin'], 'ë´„')}ì— íš¡ì¬ìˆ˜(æ©«è²¡æ•¸)ê°€ ë°œë™í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤." if OH_RELATE.get(OH.get(s['ilgan'],{}),'{}').get('å‰‹') in strong else f"ì„±ì‹¤í•¨ê³¼ ë…¸ë ¥ì´ ìŒ“ì¼ìˆ˜ë¡ ì¬ë³µì´ ë‘í…ê²Œ ë°œë™í•˜ëŠ” êµ¬ì¡°ì…ë‹ˆë‹¤. í•œíƒ•ë³´ë‹¤ ë¬µë¬µíˆ ìŒ“ì•„ê°€ëŠ” ê¸¸ì´ í•˜ëŠ˜ì˜ ëœ»ì…ë‹ˆë‹¤."}

â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
ã€ì œ5ì¥ â€” ê±´ê°•ê³¼ ì‚¬ê³ ìˆ˜(äº‹æ•…æ•¸)ã€‘

{ilgan_d['health']}

{f"ê¸°ì‹  ì˜¤í–‰ì¸ {', '.join(OHN[k] for k in weak)}ê³¼ ê´€ë ¨ëœ {', '.join(OH_ORGAN.get(k,'') for k in weak)} ê³„í†µì€ {', '.join(OH_SEASON.get(k,'í™˜ì ˆê¸°') for k in weak)}ì— í‰ì„±(å‡¶æ˜Ÿ)ì´ ë°œë™í•˜ê¸° ì‰¬ìš°ë‹ˆ ì´ ì‹œê¸°ì— ê°ë³„íˆ ë³´ì‚´í”¼ì‹­ì‹œì˜¤." if weak else "ì˜¤í–‰ ê· í˜•ì´ ì¡í˜€ ì„ ì²œì ìœ¼ë¡œ ê±´ê°•í•œ ì²´ì§ˆì˜ ë³µì„ íƒ€ê³ ë‚¬ìŠµë‹ˆë‹¤."}

ì‚¬ê³ ìˆ˜ê°€ ë“œëŠ” ì‹œê¸°ì—ëŠ” êµí†µ, ìˆ˜ìˆ , ì™¸ìƒì— ì£¼ì˜í•˜ê³  ìƒˆë²½ ê¸°ë„ì™€ ì¡°ìƒì‹ ê»˜ ê°€í˜¸ë¥¼ êµ¬í•˜ëŠ” ê²ƒì´ ì•¡ìš´ì„ ë¬¼ë¦¬ì¹˜ëŠ” ë¹„ë°©(ç§˜æ–¹)ì…ë‹ˆë‹¤.

â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
ã€ê²°ë¡  â€” ì¡°ìƒì‹ ì´ ì „í•˜ëŠ” ì²œëª…ì˜ ë©”ì‹œì§€ã€‘

ë‹¹ì‹ ì˜ ì‚¬ì£¼ì—ëŠ” ë¶„ëª…í•œ ì²œëª…ì´ ë¹›ë‚˜ê³  ìˆìŠµë‹ˆë‹¤. í•˜ëŠ˜ì´ ì ì§€í•œ ì²œì§ì˜ ê¸¸ì—ì„œ ê·€ì¸ì´ ê¸°ë‹¤ë¦¬ê³  ìˆìœ¼ë©°, ì¡°ìƒì‹ ì´ ì´ë¯¸ ê·¸ ê¸¸ì— ë³µì„ ì‹¬ì–´ë‘ì—ˆìŠµë‹ˆë‹¤.

ë³µì„±ì´ ë“œëŠ” ì‹œê¸°ì—ëŠ” ì˜¤ë˜ ê¸°ë‹¤ë ¤ì˜¨ ê¿ˆì„ ê³¼ê°íˆ ê²°í–‰í•˜ì‹­ì‹œì˜¤. ê¸°ì‹ ì´ ë°œë™í•˜ëŠ” ì‹œë ¨ì˜ ì‹œê¸°ì—ëŠ” ìš•ì‹¬ì„ ë‚´ë ¤ë†“ê³  ì„ í–‰ì„ ìŒ“ìœ¼ë©° ê¸°ë„í•˜ì‹­ì‹œì˜¤. í•˜ëŠ˜ì€ ê³ í†µ ì†ì—ì„œë„ ë°˜ë“œì‹œ íƒˆì¶œêµ¬ë¥¼ ì—´ì–´ë‘ì‹­ë‹ˆë‹¤.

ì‹œë ¨ì€ ë” í° ë³µì„ ìœ„í•œ í•˜ëŠ˜ì˜ ì¤€ë¹„ ê³¼ì •ì…ë‹ˆë‹¤. ì¡°ìƒì‹ ì˜ ìŒë•ì„ ë°›ë“¤ê³  ì²œëª…ì˜ ê¸¸ì„ ë‹¹ë‹¹íˆ ê±¸ì–´ê°€ì‹œê¸¸ ë°”ëë‹ˆë‹¤.

â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
âš ï¸ ìì²´ ë¶„ì„ ëª¨ë“œ â€” Groq API í‚¤ ì…ë ¥ ì‹œ ë”ìš± ê¹Šì€ ì‹ ëª… í’€ì´ë¥¼ ë°›ìœ¼ì‹¤ ìˆ˜ ìˆìŠµë‹ˆë‹¤"""
    return txt

def self_wealth(s, form):
    oh_cnt = s["oh_cnt"]
    analysis = get_oh_analysis(oh_cnt)
    strong, weak = analysis["strong"], analysis["weak"]
    yon = get_yongshin(s["ilgan"], oh_cnt)
    seed = str_seed(s["ilgan"] + str(s["birth_year"]))
    wealth_season = OH_SEASON.get(yon["yongshin"]) or pick(["ë´„(1~3ì›”)","ì—¬ë¦„(4~6ì›”)","ê°€ì„(7~9ì›”)","ê²¨ìš¸(10~12ì›”)"], seed)
    caution_season = OH_SEASON.get(weak[0]) if weak else pick(["3ì›”","6ì›”","9ì›”","12ì›” í™˜ì ˆê¸°"], seed+1)
    job_label = JKR.get(form.get("job",""), "ì§ì¥ì¸")
    ilgan_oh = OH.get(s["ilgan"], "æœ¨")
    wealth_oh = OH_RELATE.get(ilgan_oh, {}).get("å‰‹", "")

    return f"""â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
ğŸ’° ì¬ë¬¼ìš´ â€” í•˜ëŠ˜ì´ ì—´ì–´ë‘” ì¬ë³µ(è²¡ç¦)ì˜ ë¬¸
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”

ã€ì¬ë³µ(è²¡ç¦)ì˜ ë¿Œë¦¬ã€‘
{s['ilgan']}({s['ilgan_kr']}) ì¼ê°„ì˜ ì¬ì„±ì€ {OHN.get(wealth_oh, 'ê· í˜• ì¡íŒ')} ê¸°ìš´ìœ¼ë¡œ, ì´ê²ƒì´ ë‹¹ì‹ ì˜ ì¬ë¬¼ë³µì„ ì£¼ê´€í•˜ëŠ” ì‹ ëª…(ç¥æ˜)ì˜ ê¸°ìš´ì…ë‹ˆë‹¤.

{f"ì¬ë³µì˜ ì”¨ì•—ì´ ì‚¬ì£¼ì— ë‘í…ê²Œ ìë¦¬í•˜ê³  ìˆìŠµë‹ˆë‹¤. í•˜ëŠ˜ì´ ì¬ë¬¼ì˜ ê¸°ìš´ì„ ê°•í•˜ê²Œ ë‚´ë ¤ì£¼ì…¨ìœ¼ë‹ˆ ì˜¬ë°”ë¥´ê²Œ í™œìš©í•˜ë©´ í° ë¶€ë¥¼ ì´ë£° ìˆ˜ ìˆìŠµë‹ˆë‹¤. ë‹¤ë§Œ ì¬ë¬¼ì— ì§€ë‚˜ì¹˜ê²Œ ì§‘ì°©í•˜ë©´ ì˜¤íˆë ¤ ë³µì´ ìƒˆì–´ë‚˜ê°€ë‹ˆ ë² í’€ê³  ë‚˜ëˆ„ëŠ” ë§ˆìŒì´ ì¬ë³µì„ ë”ìš± í‚¤ì›ë‹ˆë‹¤." if wealth_oh in strong else "ì¬ë³µì˜ ì”¨ì•—ì€ í•œ ë²ˆì— í„°ì§€ëŠ” ê½ƒì´ ì•„ë‹ˆë¼ ê¾¸ì¤€íˆ ìë¼ëŠ” ë‚˜ë¬´ì™€ ê°™ìŠµë‹ˆë‹¤. ì„±ì‹¤í•¨ê³¼ ë…¸ë ¥ì´ ìŒ“ì¼ìˆ˜ë¡ ë” ë‘í…ê²Œ ë°œë™í•©ë‹ˆë‹¤. í•œíƒ•ì„ ë…¸ë¦¬ëŠ” íˆ¬ê¸°ë³´ë‹¤ ë¬µë¬µíˆ ìŒ“ì•„ê°€ëŠ” ê¸¸ì´ í•˜ëŠ˜ì˜ ëœ»ì…ë‹ˆë‹¤."}

ã€íš¡ì¬ìˆ˜(æ©«è²¡æ•¸) â€” ëœ»ë°–ì˜ ë³µì´ ë“œëŠ” ì‹œê¸°ã€‘
ì´ ì‚¬ì£¼ì˜ íš¡ì¬ìˆ˜ëŠ” ìš©ì‹  ê¸°ìš´ì´ ì¶©ë§Œí•´ì§€ëŠ” {wealth_season}ì— ê°€ì¥ ê°•í•˜ê²Œ ë°œë™í•©ë‹ˆë‹¤. ì´ ì‹œê¸°ì—ëŠ” ì˜¤ë˜ëœ ì¸ì—°ì´ ì¢‹ì€ ì†Œì‹ì„ ê°€ì ¸ì˜¤ê±°ë‚˜, ì˜ˆìƒì¹˜ ëª»í–ˆë˜ ê¸°íšŒê°€ ì—´ë¦¬ê±°ë‚˜, ìˆ¨ê²¨ì§„ ìˆ˜ì…ì´ ìƒê¸°ëŠ” ì¼ì´ ì¼ì–´ë‚  ìˆ˜ ìˆìŠµë‹ˆë‹¤. ì¡°ìƒì‹ ì´ ì´ ì‹œê¸°ì— ê°€ì¥ ê°•í•˜ê²Œ ì¬ë¬¼ì˜ ë¬¸ì„ ì—´ì–´ì£¼ì‹­ë‹ˆë‹¤.

ë°˜ë©´ ê¸°ì‹  ê¸°ìš´ì´ ê°•í•´ì§€ëŠ” {caution_season}ì—ëŠ” ì¬ë¬¼ ì†ì‹¤ì˜ í‰ì„±(å‡¶æ˜Ÿ)ì´ ë°œë™í•˜ê¸° ì‰½ìŠµë‹ˆë‹¤. ì´ ì‹œê¸°ì—ëŠ” íˆ¬ê¸°ì„± íˆ¬ì, ë³´ì¦, ë™ì—… ë“±ì„ ì‚¼ê°€ê³  ì´ë¯¸ ìŒ“ì•„ì˜¨ ì¬ì‚°ì„ ì§€í‚¤ëŠ” ë° ì§‘ì¤‘í•˜ì‹­ì‹œì˜¤.

ã€{job_label} ì§ë¶„ì—ì„œì˜ ì¬ë³µã€‘
{f"í•˜ëŠ˜ì´ ì‚¬ì—…Â·ìë¦½ì˜ ê¸¸ì„ í†µí•´ ì¬ë³µì„ ì—´ì–´ì£¼ëŠ” êµ¬ì¡°ì…ë‹ˆë‹¤. ìš©ì‹  ê¸°ìš´ì´ ê°•í•œ ì‹œê¸°ì— ê³¼ê°íˆ ë„ì „í•˜ê³ , ê¸°ì‹  ê¸°ìš´ì´ ê°•í•  ë•ŒëŠ” ë‚´ì‹¤ì„ ë‹¤ì§€ëŠ” ì§€í˜œê°€ í•„ìš”í•©ë‹ˆë‹¤." if form.get("job") in ["business","freelance"] else f"ì§ë¶„ì— ì¶©ì‹¤í•˜ê²Œ ë³µë¬´í•˜ë©´ì„œ ìŒ“ì´ëŠ” ì‹ ìš©ê³¼ ì‹¤ë ¥ì´ ì¬ë³µì˜ ê·¼ì›ì…ë‹ˆë‹¤. ìš©ì‹  ë°©í–¥ì¸ {OH_DIR.get(yon['yongshin'], 'ë‚¨ìª½')}ì„ í™œìš©í•˜ë©´ ì¡°ìƒì‹ ì˜ ë„ì›€ì´ ë”í•´ì§‘ë‹ˆë‹¤."}

ã€ì¬ë¬¼ë³µì„ ì—¬ëŠ” ë¹„ë°©(ç§˜æ–¹)ã€‘
ì²«ì§¸, íƒìš•ì„ ê²½ê³„í•˜ì‹­ì‹œì˜¤. í•˜ëŠ˜ì€ ê°ì‚¬í•˜ëŠ” ìì—ê²Œ ë” ë§ì€ ê²ƒì„ ì±„ì›Œì£¼ì‹­ë‹ˆë‹¤.
ë‘˜ì§¸, ì¬ë¬¼ì´ ë“œëŠ” ë°©í–¥ {OH_DIR.get(yon['yongshin'], 'ë‚¨ìª½')}ìœ¼ë¡œ ì§€ê°‘ì´ë‚˜ ê¸ˆê³ ë¥¼ ë†“ê³ , {OH_COLOR_MAP.get(yon['yongshin'], 'ë‹¤ì–‘í•œ ìƒ‰ìƒ')}ì„ ì¬ë¬¼ ê´€ë ¨ ë¬¼ê±´ì— í™œìš©í•˜ì‹­ì‹œì˜¤.
ì…‹ì§¸, ìŒë ¥ ì´ˆí•˜ë£¨ì™€ ë³´ë¦„ì— ì¡°ìƒì‹ ê»˜ ê°ì‚¬ì˜ ë§ˆìŒì„ ì˜¬ë¦¬ë©´ ì¬ë³µì˜ ê¸°ìš´ì´ ë”ìš± ì™•ì„±í•´ì§‘ë‹ˆë‹¤.

â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
âš ï¸ ìì²´ ë¶„ì„ ëª¨ë“œ â€” Groq API í‚¤ ì…ë ¥ ì‹œ ë”ìš± ê¹Šì€ ì‹ ëª… í’€ì´ë¥¼ ë°›ìœ¼ì‹¤ ìˆ˜ ìˆìŠµë‹ˆë‹¤"""

def self_love(s, form):
    oh_cnt = s["oh_cnt"]
    yon = get_yongshin(s["ilgan"], oh_cnt)
    gender = "ë‚¨ì„±" if form.get("gender") == "male" else "ì—¬ì„±"
    o_gender = "ì—¬ì„±" if form.get("gender") == "male" else "ë‚¨ì„±"
    marital = MKR.get(form.get("marital","single"), "ë¯¸í˜¼")
    dp = s["pillars"][1]
    ilgan_oh = OH.get(s["ilgan"], "æœ¨")
    partner_oh = OH_RELATE.get(ilgan_oh, {}).get("å‰‹") if form.get("gender") == "male" else OH_RELATE.get(ilgan_oh, {}).get("è¢«å‰‹")
    ideal_dir = OH_DIR.get(partner_oh) or OH_DIR.get(yon["yongshin"]) or "ë™ìª½"

    return f"""â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
ğŸ’• ì—°ì• Â·ê²°í˜¼ìš´ â€” í•˜ëŠ˜ì´ ë¶‰ì€ ì‹¤ë¡œ ë§ºì€ ì¸ì—°
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”

ã€ì²œìƒì—°ë¶„(å¤©ç”Ÿç·£åˆ†) â€” í•˜ëŠ˜ì´ ì ì§€í•œ ë°°í•„ì˜ ê¸°ìš´ã€‘
í•˜ëŠ˜ì€ ì‚¬ëŒì„ ë‚´ë³´ë‚¼ ë•Œ ì´ë¯¸ ë¶‰ì€ ì‹¤ë¡œ ë°°í•„ì„ ì •í•´ë‘ì—ˆë‹¤ê³  í•©ë‹ˆë‹¤. {s['ilgan']}({s['ilgan_kr']}) ì¼ê°„ {gender}ì—ê²ŒëŠ” ê·¸ ì²œì„±ê³¼ ì¡°í™”ë¥¼ ì´ë£¨ëŠ” íŠ¹ë³„í•œ ì¸ì—°ì´ ì •í•´ì ¸ ìˆìŠµë‹ˆë‹¤.

ì¼ì§€(æ—¥æ”¯) {dp['jj']}({dp['jjk']})ëŠ” ì „ìƒì˜ ì—…(æ¥­)ê³¼ ì¸ì—°ì´ ìƒˆê²¨ì§„ ë°°ìš°ì ìë¦¬ì…ë‹ˆë‹¤. {JJ_CHAR.get(dp['jj'], 'ê°•í•œ ê¸°ìš´ì„ ì§€ë‹Œ')} ê¸°ìš´ì˜ ë°°ìš°ìì™€ ì²œìƒì˜ ì¸ì—°ì´ ê¹Šìœ¼ë©°, ì¡°ìƒì‹ ì´ ê°€ì¥ ê°•í•˜ê²Œ ê·¸ ì¸ì—°ì„ ì¶•ë³µí•˜ì‹­ë‹ˆë‹¤.

{f"ë‚¨ì„±ì˜ ë°°í•„ì„±ì€ ì¬ì„±(è²¡æ˜Ÿ)ì…ë‹ˆë‹¤. ìì‹ ì´ ì•„ë¼ê³  ë³´ì‚´í”¼ê³  ì‹¶ì€ ë§ˆìŒì´ ë“œëŠ” ì´ì„±ì´ ì²œìƒì—°ë¶„ì˜ ê¸°ìš´ì„ ì§€ë‹Œ ì‚¬ëŒì…ë‹ˆë‹¤." if form.get('gender') == 'male' else "ì—¬ì„±ì˜ ë°°í•„ì„±ì€ ê´€ì„±(å®˜æ˜Ÿ)ì…ë‹ˆë‹¤. ë¯¿ìŒì§í•˜ê³  ë“ ë“ í•˜ì—¬ ìì—°ìŠ¤ëŸ½ê²Œ ì˜ì§€í•˜ê³  ì‹¶ì€ ë§ˆìŒì´ ë“œëŠ” ì´ì„±ì´ ì²œìƒì—°ë¶„ì˜ ê¸°ìš´ì„ ì§€ë‹Œ ì‚¬ëŒì…ë‹ˆë‹¤."}

ã€í˜„ì¬ ì¸ì—°ì˜ íë¦„ â€” ì‹ ëª…ì´ ë³´ë‚´ëŠ” ì‹ í˜¸ã€‘
í˜„ì¬ {marital} ìƒíƒœì¸ ë‹¹ì‹ ì˜ ì¸ì—° íë¦„ì„ ë³´ë‹ˆ, {f"ì•„ì§ ê½ƒì„ í”¼ìš°ì§€ ì•Šì€ ë´„ë‚ ì˜ ì”¨ì•—ê³¼ ê°™ìŠµë‹ˆë‹¤. í•˜ëŠ˜ì´ ì´ë¯¸ ì •í•´ë‘” ì¸ì—°ì´ ë•Œë¥¼ ê¸°ë‹¤ë¦¬ê³  ìˆìœ¼ë‹ˆ ì¡°ê¸‰í•´í•˜ì§€ ë§ˆì‹­ì‹œì˜¤. ê·€ì¸ì„ í†µí•œ ì†Œê°œë‚˜ ëœ»ë°–ì˜ ë§Œë‚¨ì„ í†µí•´ ì²œìƒì—°ë¶„ì´ ë‚˜íƒ€ë‚  ê°€ëŠ¥ì„±ì´ ë†’ìŠµë‹ˆë‹¤." if form.get("marital") == "single" else "í•˜ëŠ˜ì´ ë¶‰ì€ ì‹¤ë¡œ ì´ì–´ì¤€ ì†Œì¤‘í•œ ì¸ì—°ê³¼ í•¨ê»˜í•˜ê³  ìˆìŠµë‹ˆë‹¤. ê°ì‚¬ì™€ ë°°ë ¤ë¡œ ì´ ì¸ì—°ì„ ë§¤ì¼ ìƒˆë¡­ê²Œ ê°€ê¾¸ëŠ” ê²ƒì´ ì¡°ìƒì‹ ê»˜ ë“œë¦¬ëŠ” ê°€ì¥ ì•„ë¦„ë‹¤ìš´ ê°ì‚¬ì…ë‹ˆë‹¤." if form.get("marital") == "married" else "í•˜ëŠ˜ì€ ìƒˆë¡œìš´ ì¸ì—°ì˜ ì”¨ì•—ì„ ì´ë¯¸ ì¤€ë¹„í•´ë‘ê³  ìˆìŠµë‹ˆë‹¤. ìƒì²˜ë¥¼ ì¹˜ìœ í•˜ê³  ìŠ¤ìŠ¤ë¡œë¥¼ ì‚¬ë‘í•  ë•Œ ì¡°ìƒì‹ ì´ ë” ê¹Šê³  ì„±ìˆ™í•œ ì¸ì—°ì„ ì´ëŒì–´ì£¼ì‹­ë‹ˆë‹¤."}

ê·€ì¸ì„±(è²´äººæ˜Ÿ)ì´ ê°•í•˜ê²Œ ë°œë™í•˜ëŠ” ë°©í–¥ì€ {ideal_dir}ì´ë©°, {OH_COLOR_MAP.get(partner_oh) or OH_COLOR_MAP.get(yon['yongshin'], 'ë‹¤ì–‘í•œ ìƒ‰ìƒ')}ì„ ëª¸ì— ê°€ê¹Œì´ í•˜ë©´ ì´ì„±ìš´ì´ í™œì„±í™”ë©ë‹ˆë‹¤.

â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
âš ï¸ ìì²´ ë¶„ì„ ëª¨ë“œ â€” Groq API í‚¤ ì…ë ¥ ì‹œ ë”ìš± ê¹Šì€ ì‹ ëª… í’€ì´ë¥¼ ë°›ìœ¼ì‹¤ ìˆ˜ ìˆìŠµë‹ˆë‹¤"""

def self_health(s, form):
    oh_cnt = s["oh_cnt"]
    analysis = get_oh_analysis(oh_cnt)
    strong, weak = analysis["strong"], analysis["weak"]
    yon = get_yongshin(s["ilgan"], oh_cnt)
    ilgan_d = ILGAN_DESC.get(s["ilgan"], ILGAN_DESC["ç”²"])
    ilgan = s["ilgan"]

    if ilgan in ["ç”²","ä¹™"]:
        lifestyle = "ê°„ë‹´(è‚è†½)ì˜ ì‹ ëª…ì„ ì§€í‚¤ê¸° ìœ„í•´ ìŒì£¼ë¥¼ ì ˆì œí•˜ê³  ì¶©ë¶„í•œ ìˆ˜ë©´ì„ ì·¨í•˜ì‹­ì‹œì˜¤. ìˆ²ê³¼ ìì—°ì˜ ê¸°ìš´ì´ ì´ ì¼ê°„ì˜ ê±´ê°•ì‹ ì„ ê°•í™”í•©ë‹ˆë‹¤."
    elif ilgan in ["ä¸™","ä¸"]:
        lifestyle = "ì‹¬ì¥ì˜ ì‹ ëª…ì„ ì§€í‚¤ê¸° ìœ„í•´ ê³¼ë„í•œ ì—´ì •ê³¼ í¥ë¶„ì„ ë‹¤ìŠ¤ë¦¬ê³  ë§ˆìŒì˜ í‰í™”ë¥¼ ìœ ì§€í•˜ì‹­ì‹œì˜¤."
    elif ilgan in ["æˆŠ","å·±"]:
        lifestyle = "ë¹„ìœ„(è„¾èƒƒ)ì˜ ì‹ ëª…ì„ ì§€í‚¤ê¸° ìœ„í•´ í­ì‹Â·ê³¼ì‹ì„ ì‚¼ê°€ê³  ê·œì¹™ì ì¸ ì‹ì‚¬ë¥¼ í•˜ì‹­ì‹œì˜¤."
    elif ilgan in ["åºš","è¾›"]:
        lifestyle = "íì™€ í˜¸í¡ê¸°ì˜ ì‹ ëª…ì„ ì§€í‚¤ê¸° ìœ„í•´ ë§‘ì€ ê³µê¸°ì™€ ê¹Šì€ í˜¸í¡ì„ ìŠµê´€í™”í•˜ì‹­ì‹œì˜¤."
    else:
        lifestyle = "ì‹ ì¥Â·ë°©ê´‘ì˜ ì‹ ëª…ì„ ì§€í‚¤ê¸° ìœ„í•´ ì¶©ë¶„í•œ ìˆ˜ë¶„ ì„­ì·¨ì™€ ë”°ëœ»í•œ ì²´ì˜¨ ìœ ì§€ë¥¼ ìƒí™œí™”í•˜ì‹­ì‹œì˜¤."

    yon_food = {
        "æœ¨":"ì‹ ì„ í•œ ì±„ì†Œ, ë…¹ì°¨, ìƒˆì‹¹ ìŒì‹ì´ ì´ ì‚¬ì£¼ì˜ ê±´ê°•ì‹ ì„ ê¹¨ì›ë‹ˆë‹¤. ìˆ² ì† ì‚°ì±…ì´ ì‹ ëª…ì„ ë§‘ê²Œ í•©ë‹ˆë‹¤.",
        "ç«":"ë”°ëœ»í•˜ê³  ê¸°ìš´ì„ ë¶ë‹ëŠ” ìŒì‹ì´ ì¢‹ìŠµë‹ˆë‹¤. ì¶©ë¶„í•œ í–‡ë¹›ê³¼ ë”°ëœ»í•œ í™˜ê²½ì´ ê¸°ìš´ì„ ì‚´ë¦½ë‹ˆë‹¤.",
        "åœŸ":"í™©í† ìƒ‰ ìŒì‹(ë‹¨í˜¸ë°•, ê³ êµ¬ë§ˆ)ì´ ì´ ì‚¬ì£¼ë¥¼ ì•ˆì •ì‹œí‚µë‹ˆë‹¤. í…ƒë°­ ê°€ê¾¸ê¸°ë‚˜ ë§¨ë°œ ê±·ê¸°ê°€ ì‹ ëª…ì„ ì•ˆì •ì‹œí‚µë‹ˆë‹¤.",
        "é‡‘":"í°ìƒ‰ ìŒì‹(ë¬´, ë°°, ë„ë¼ì§€)ì´ ê±´ê°•ì‹ ì„ ê°•í™”í•©ë‹ˆë‹¤. ë§‘ì€ ê³µê¸°ì™€ ê¹Šì€ í˜¸í¡ì´ ì‹ ëª…ì„ ë§‘ê²Œ í•©ë‹ˆë‹¤.",
        "æ°´":"ê²€ì€ìƒ‰ ìŒì‹(ê²€ì€ê¹¨, ë¯¸ì—­, ë‹¤ì‹œë§ˆ)ì´ ìƒëª…ë ¥ì„ ë³´ê°•í•©ë‹ˆë‹¤. ë”°ëœ»í•œ ë¬¼ì„ ì¶©ë¶„íˆ ë§ˆì‹œê³  ëƒ‰ê¸°ë¥¼ í”¼í•˜ì‹­ì‹œì˜¤."
    }.get(yon["yongshin"], "ê· í˜• ì¡íŒ ì‹ë‹¨ìœ¼ë¡œ ì˜¤í–‰ì˜ ì¡°í™”ë¥¼ ìœ ì§€í•˜ì‹­ì‹œì˜¤.")

    return f"""â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
ğŸ¥ ê±´ê°•ìš´ â€” í•˜ëŠ˜ì´ ë§¡ê¸´ ëª¸ì˜ ì‹ ëª…(èº«å‘½)
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”

ã€ì‚¬ê³ ìˆ˜(äº‹æ•…æ•¸)ì™€ ë³‘ì•¡(ç—…å„) â€” í•˜ëŠ˜ì˜ ê²½ê³ ë¥¼ ì½ë‹¤ã€‘
í•˜ëŠ˜ì€ ê¸°ì‹ (å¿Œç¥)ì´ ë°œë™í•˜ê¸° ì „ì— ë°˜ë“œì‹œ ê²½ê³ ì˜ ì‹ í˜¸ë¥¼ ë³´ëƒ…ë‹ˆë‹¤. ëª¸ì´ ë³´ë‚´ëŠ” ì‘ì€ ì‹ í˜¸ê°€ ë°”ë¡œ ê·¸ê²ƒì´ë©°, ì´ë¥¼ ì•Œì•„ì±„ê³  ëŒ€ë¹„í•˜ëŠ” ê²ƒì´ ì²œìˆ˜(å¤©å£½)ë¥¼ ëˆ„ë¦¬ëŠ” ì§€í˜œì…ë‹ˆë‹¤.

{s['ilgan']}({s['ilgan_kr']}) ì¼ê°„ì˜ ì„ ì²œì ìœ¼ë¡œ ë³´ì‚´í´ì•¼ í•  ë¶€ìœ„: {ilgan_d['health']}

ã€ì˜¤í–‰ìœ¼ë¡œ ë³¸ ì·¨ì•½ ê¸°ìš´ã€‘
{f"ë¶€ì¡±í•œ ì˜¤í–‰ì¸ {', '.join(OHN.get(k,'') + '(' + OH_ORGAN.get(k,'') + ')' for k in weak)} ê³„í†µì€ í‰ì„±ì´ ë°œë™í•˜ê¸° ì‰¬ìš´ ì‹œê¸°ê°€ ìˆìŠµë‹ˆë‹¤. {', '.join(OH_SEASON.get(k,'í™˜ì ˆê¸°') for k in weak)} ì‹œê¸°ì— ì´ ê³„í†µì˜ ë³‘ì•¡ì´ ë°œë™í•˜ê¸° ì‰¬ìš°ë‹ˆ ì •ê¸° ê±´ê°•ê²€ì§„ì„ ë°›ìœ¼ì‹­ì‹œì˜¤." if weak else "ì˜¤í–‰ êµ¬ì¡°ê°€ ê· í˜• ì¡í˜€ ì„ ì²œì ìœ¼ë¡œ ê±´ê°•í•œ ì²´ì§ˆì˜ ë³µì„ íƒ€ê³ ë‚¬ìŠµë‹ˆë‹¤. ì´ ê±´ê°•ì˜ ë³µì„ ë‹¹ì—°íˆ ì—¬ê¸°ì§€ ë§ê³  ëŠ˜ ê°ì‚¬íˆ ì—¬ê¸°ì‹­ì‹œì˜¤."}

ã€ì²œìˆ˜(å¤©å£½)ë¥¼ ëˆ„ë¦¬ëŠ” ë¹„ë°©(ç§˜æ–¹)ã€‘
ì²«ì§¸, {lifestyle}
ë‘˜ì§¸, ê¸°ì‹  ê¸°ìš´ì´ ë°œë™í•˜ëŠ” ì‹œê¸°ì—ëŠ” ìƒˆë²½ ê¸°ë„ì™€ ì¡°ìƒì‹ ê»˜ í‰ì•ˆì„ êµ¬í•˜ëŠ” ê²ƒì´ ë³‘ì•¡ì„ ë¬¼ë¦¬ì¹˜ëŠ” ì˜ì  ë¹„ë°©ì…ë‹ˆë‹¤. ìŒë ¥ ì´ˆí•˜ë£¨ì™€ ë³´ë¦„ì— ì²­ìˆ˜(ë§‘ì€ ë¬¼)ë¥¼ ì˜¬ë¦¬ë©´ ì¡°ìƒì‹ ì˜ ê°€í˜¸ê°€ ê°•í•´ì§‘ë‹ˆë‹¤.
ì…‹ì§¸, {yon_food}

â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
âš ï¸ ìì²´ ë¶„ì„ ëª¨ë“œ â€” Groq API í‚¤ ì…ë ¥ ì‹œ ë”ìš± ê¹Šì€ ì‹ ëª… í’€ì´ë¥¼ ë°›ìœ¼ì‹¤ ìˆ˜ ìˆìŠµë‹ˆë‹¤"""

def self_career(s, form):
    oh_cnt = s["oh_cnt"]
    analysis = get_oh_analysis(oh_cnt)
    strong, weak = analysis["strong"], analysis["weak"]
    yon = get_yongshin(s["ilgan"], oh_cnt)
    ilgan_d = ILGAN_DESC.get(s["ilgan"], ILGAN_DESC["ç”²"])
    job_label = JKR.get(form.get("job",""), "ì§ì¥ì¸")
    ilgan_oh = OH.get(s["ilgan"], "æœ¨")
    gwan_oh = OH_RELATE.get(ilgan_oh, {}).get("è¢«å‰‹", "")
    sik_oh = OH_RELATE.get(ilgan_oh, {}).get("å‰‹", "")

    if gwan_oh in strong:
        strength_desc = "ê´€ì„±ì´ ê°•í•˜ê²Œ ìë¦¬í•˜ê³  ìˆì–´ í•˜ëŠ˜ì´ ì¡°ì§ê³¼ ê³µì§ì˜ ê¸¸ì„ ì²œì§ìœ¼ë¡œ ì ì§€í•˜ì…¨ìŠµë‹ˆë‹¤. ìœ„ê³„ì™€ ì§ˆì„œ ì†ì—ì„œ ì‚¬íšŒì  ì—­í• ì„ ì¶©ì‹¤íˆ ì´í–‰í•  ë•Œ ì¡°ìƒì‹ ì˜ ìŒë•ì´ ìŠ¹ì§„ê³¼ ëª…ì˜ˆë¡œ ì´ì–´ì§‘ë‹ˆë‹¤."
    elif sik_oh in strong:
        strength_desc = "ì‹ìƒ ê¸°ìš´ì´ ê°•í•´ í•˜ëŠ˜ì´ ì°½ì˜ì™€ ììœ ì˜ ê¸¸ì„ ì²œì§ìœ¼ë¡œ ì ì§€í•˜ì…¨ìŠµë‹ˆë‹¤. ìì‹ ì˜ ê¸°ìˆ ê³¼ ì¬ëŠ¥ì„ ì§ì ‘ ë°œíœ˜í•˜ëŠ” ìë¦¬ì—ì„œ ì‹ ëª…ì´ ê°€ì¥ ê°•í•˜ê²Œ ë°œë™í•©ë‹ˆë‹¤."
    else:
        strength_desc = "ê´€ì„±ê³¼ ì‹ìƒì´ ê· í˜•ì„ ì´ë£¨ì–´ ì¡°ì§ê³¼ ì°½ì˜ì„± ì‚¬ì´ì—ì„œ ìœ ì—°í•˜ê²Œ ë¹›ì„ ë°œí•˜ëŠ” ì²œì§ êµ¬ì¡°ì…ë‹ˆë‹¤."

    job_specific = {
        "employee": "í•˜ëŠ˜ì´ ì¡°ì§ì˜ ê¸¸ì—ì„œ ë³µì„ ì—´ì–´ì£¼ëŠ” êµ¬ì¡°ì…ë‹ˆë‹¤. ìƒì‚¬ì™€ ë™ë£Œì—ê²Œ ì‹ ë¢°ë¥¼ ìŒ“ëŠ” ê²ƒì´ ì¡°ìƒì‹ ì´ ì›í•˜ì‹œëŠ” ë°”ì´ë©°, ìš©ì‹  ê¸°ìš´ì´ ê°•í•´ì§€ëŠ” ì‹œê¸°ì— ìŠ¹ì§„ì˜ ë³µì„±(ç¦æ˜Ÿ)ì´ ë°œë™í•©ë‹ˆë‹¤.",
        "business": "í•˜ëŠ˜ì´ ì‚¬ì—…ì˜ ê¸¸ì—ì„œ ì¬ë³µ(è²¡ç¦)ì„ ì—´ì–´ì£¼ëŠ” êµ¬ì¡°ì…ë‹ˆë‹¤. ê·€ì¸ê³¼ í˜‘ë ¥í•˜ëŠ” ë°©ì‹ì´ ì¡°ìƒì‹ ì´ ê°€ì¥ í˜ì„ ì‹¤ì–´ì£¼ì‹œëŠ” ë°©ì‹ì…ë‹ˆë‹¤.",
        "artist": "ì˜ˆìˆ ê³¼ ì°½ì‘ì˜ ê¸¸ì—ì„œ í•˜ëŠ˜ì´ ë‚´ë¦¬ì‹  ì‹ ëª…ì´ ê°€ì¥ ê°•í•˜ê²Œ ë°œë™í•©ë‹ˆë‹¤. ë‚´ê³µì„ ìŒ“ëŠ” ì‹œê°„ ì—­ì‹œ ë„ì•½ì˜ ì „ ë‹¨ê³„ì…ë‹ˆë‹¤.",
        "it": "ê¸°ìˆ ê³¼ ì§€ì‹ì˜ ê¸¸ì—ì„œ ê¾¸ì¤€í•œ ì—­ëŸ‰ ê°•í™”ê°€ ê·€ì¸ì„ ëŒì–´ë‹¹ê¸°ëŠ” ê°€ì¥ í™•ì‹¤í•œ ë°©ë²•ì…ë‹ˆë‹¤.",
        "finance": "ì¬ë¬¼ì˜ ê¸°ìš´ê³¼ ì´ ì²œì§ì´ ë§ë‹¿ì•„ ìˆì–´ ì¡°ìƒì‹ ì´ ì¬ë³µì˜ ë¬¸ì„ ì—´ì–´ë‘ì…¨ìŠµë‹ˆë‹¤. ì›ì¹™ ìˆëŠ” íŒë‹¨ì´ í•˜ëŠ˜ì˜ ëœ»ì— ë¶€í•©í•©ë‹ˆë‹¤.",
    }.get(form.get("job",""), "í˜„ì¬ì˜ ì§ë¶„ì—ì„œ íƒ€ê³ ë‚œ ì‹ ëª…ì„ ì¶©ì‹¤íˆ ë°œíœ˜í•˜ë©´ í•˜ëŠ˜ì´ ë•Œë¥¼ ë§ì¶° ë” í° ê¸¸ì„ ì—´ì–´ì£¼ì‹­ë‹ˆë‹¤.")

    return f"""â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
ğŸ’¼ ì§ì—…ìš´ â€” í•˜ëŠ˜ì´ ì ì§€í•œ ì²œì§(å¤©è·)
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”

ã€ì²œì§(å¤©è·) â€” í•˜ëŠ˜ì´ ì •í•´ë‘” ë‹¹ì‹ ì˜ ìë¦¬ã€‘
{s['ilgan']}({s['ilgan_kr']}) ì¼ê°„ì—ê²Œ í•˜ëŠ˜ì´ ì ì§€í•œ ì²œì§: {ilgan_d['career']}

ì´ ê¸¸ì—ì„œ ì¼í•  ë•Œ ë³´ì´ì§€ ì•ŠëŠ” ê·€ì¸(è²´äºº)ì´ ì°¾ì•„ì˜¤ê³  ì¡°ìƒì‹ ì´ ê¸¸ì„ ì—´ì–´ì£¼ì‹­ë‹ˆë‹¤.

ã€ê´€ì„±ê³¼ ì‹ìƒ â€” í•˜ëŠ˜ì´ ìƒˆê¸´ ì§ì—…ì˜ ê¸°ìš´ã€‘
{strength_desc}

ã€í˜„ì¬ ì§ë¶„({job_label})ì—ì„œ í•˜ëŠ˜ì´ ì—´ì–´ì£¼ëŠ” ê¸°íšŒã€‘
{job_specific}

ã€ë³µì„±(ç¦æ˜Ÿ)ì´ ë“œëŠ” ì‹œê¸° â€” í•˜ëŠ˜ì´ ì—¬ëŠ” ê¸°íšŒì˜ ë¬¸ã€‘
ì§ì—…ìš´ì—ì„œ ë³µì„±ì´ ê°€ì¥ ê°•í•˜ê²Œ ë°œë™í•˜ëŠ” ì‹œê¸°ëŠ” {OH_SEASON.get(yon['yongshin'], 'ë´„')}ì…ë‹ˆë‹¤. ì´ ì‹œê¸°ì— ì¤‘ìš”í•œ í”„ë¡œì íŠ¸ ì°©ìˆ˜, ì´ì§, ì‚¬ì—… í™•ì¥ì„ ê²°í–‰í•˜ë©´ ì¡°ìƒì‹ ì´ ê°•í•˜ê²Œ ë’¤ë¥¼ ë°›ì³ì£¼ì‹­ë‹ˆë‹¤.

ê·€ì¸ì´ ì°¾ì•„ì˜¤ëŠ” ë°©í–¥ì¸ {OH_DIR.get(yon['yongshin'], 'ë™ìª½')}ìœ¼ë¡œ ì§ì¥ì´ë‚˜ ì‚¬ì—…ì¥ ë°©ìœ„ë¥¼ ì¡ìœ¼ë©´ í•˜ëŠ˜ì˜ ê¸°ìš´ì´ ë”ìš± ê°•í•˜ê²Œ ë„ìš°ì‹­ë‹ˆë‹¤.

â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
âš ï¸ ìì²´ ë¶„ì„ ëª¨ë“œ â€” Groq API í‚¤ ì…ë ¥ ì‹œ ë”ìš± ê¹Šì€ ì‹ ëª… í’€ì´ë¥¼ ë°›ìœ¼ì‹¤ ìˆ˜ ìˆìŠµë‹ˆë‹¤"""

def self_daewoon(s, form):
    dw = s["daewoon"]
    yon = get_yongshin(s["ilgan"], s["oh_cnt"])
    current_year = datetime.now().year
    ilgan_oh = OH.get(s["ilgan"], "æœ¨")

    active_dw = None
    for d in dw:
        if d["year"] <= current_year < d["year"] + 10:
            active_dw = d
            break
    if not active_dw and dw:
        active_dw = dw[0]

    if active_dw:
        oh_cg = OH.get(active_dw["cg"], "")
        oh_jj = OH.get(active_dw["jj"], "")
        if oh_cg == yon["yongshin"] or oh_jj == yon["yongshin"]:
            curr_desc = "ğŸŒŸ ì´ê²ƒì€ ìš©ì‹  ëŒ€ìš´ì…ë‹ˆë‹¤. í•˜ëŠ˜ì´ ë‹¹ì‹ ì˜ ì‚¬ì£¼ì— ê°€ì¥ í•„ìš”í•œ ê¸°ìš´ì„ í•œê°€ë“ ë³´ë‚´ì£¼ì‹œëŠ” í™©ê¸ˆê¸°(é»ƒé‡‘æœŸ)ì…ë‹ˆë‹¤. ì¡°ìƒì‹ ì˜ ìŒë•ì´ ê°€ì¥ ê°•í•˜ê²Œ ë°œë™í•˜ëŠ” ì‹œê¸°ë¡œ, ì¬ë¬¼Â·ì¸ì—°Â·ê±´ê°•Â·ì§ì—… ëª¨ë“  ë©´ì—ì„œ ë³µì„±ì´ ë¹›ë‚©ë‹ˆë‹¤. ì´ ê·€í•œ ì‹œê¸°ë¥¼ í—›ë˜ì´ ë³´ë‚´ì§€ ì•Šë„ë¡ ì˜¤ë«ë™ì•ˆ ê¸°ë‹¤ë ¤ì˜¨ ê¿ˆì„ í–¥í•´ ê³¼ê°íˆ ë‚˜ì•„ê°€ì‹­ì‹œì˜¤."
        elif oh_cg == ilgan_oh or oh_jj == ilgan_oh:
            curr_desc = "â­ ì¼ê°„ ê°•í™” ëŒ€ìš´ì…ë‹ˆë‹¤. í•˜ëŠ˜ì´ ë‹¹ì‹  ìì‹ ì˜ ì‹ ëª…(ç¥æ˜)ì„ ë”ìš± ê°•í™”ì‹œì¼œ ì£¼ëŠ” ì‹œê¸°ì…ë‹ˆë‹¤. ìì‹ ê°ì´ ì¶©ë§Œí•´ì§€ê³  ë‚´ë©´ì˜ ëŠ¥ë ¥ì´ ìµœëŒ€ë¡œ ë°œíœ˜ë©ë‹ˆë‹¤."
        else:
            curr_desc = "âš¡ ë³€í™”ì˜ ëŒ€ìš´ì…ë‹ˆë‹¤. ê¸°ì‹  ê¸°ìš´ì´ ì„ì—¬ ì˜ˆìƒì¹˜ ëª»í•œ ì‹œë ¨ì´ ì°¾ì•„ì˜¬ ìˆ˜ ìˆìŠµë‹ˆë‹¤. ê·¸ëŸ¬ë‚˜ í•˜ëŠ˜ì€ ë°˜ë“œì‹œ íƒˆì¶œêµ¬ë¥¼ í•¨ê»˜ ì—´ì–´ë‘ì‹­ë‹ˆë‹¤. ìš•ì‹¬ì„ ë‚´ë ¤ë†“ê³  ì„ í–‰ì„ ìŒ“ìœ¼ë©° ì¡°ìƒì‹ ê»˜ ê¸°ë„í•˜ë©´ í‰ì„±ì´ ì•½í•´ì§‘ë‹ˆë‹¤."
        curr_section = f"ã€í˜„ì¬ ëŒ€ìš´({active_dw['age']}ì„¸~, {active_dw['year']}ë…„~)ã€‘\ní˜„ì¬ {active_dw['cg']}{active_dw['jj']}({active_dw['cgk']}{active_dw['jjk']}) ëŒ€ìš´ì˜ í•œê°€ìš´ë° ì„œ ìˆìŠµë‹ˆë‹¤.\n\n{curr_desc}"
    else:
        curr_section = "ëŒ€ìš´ ì •ë³´ë¥¼ ë¶ˆëŸ¬ì˜¤ê³  ìˆìŠµë‹ˆë‹¤."

    dw_lines = []
    for d in dw[:8]:
        is_active = d["year"] <= current_year < d["year"] + 10
        oh_cg = OH.get(d["cg"], "")
        oh_jj = OH.get(d["jj"], "")
        if oh_cg == yon["yongshin"] or oh_jj == yon["yongshin"]:
            synergy = "ğŸŒŸ ë³µì„± í™©ê¸ˆ ëŒ€ìš´"
            detail = "ì¡°ìƒì‹ ì´ ê°€ì¥ ê°•í•˜ê²Œ ë„ìš°ì‹œëŠ” í™©ê¸ˆê¸°. ì ê·¹ì ìœ¼ë¡œ ë„ì „í•˜ê³  ê·€ì¸ì˜ ì¸ì—°ì„ ì†Œì¤‘íˆ í•˜ì‹­ì‹œì˜¤."
        elif oh_cg == ilgan_oh or oh_jj == ilgan_oh:
            synergy = "â­ ì‹ ëª… ê°•í™” ëŒ€ìš´"
            detail = "í•˜ëŠ˜ì´ ì‹ ëª…ì„ ê°•í™”í•˜ëŠ” ì‹œê¸°. ìì‹ ì˜ ëŠ¥ë ¥ì„ ë¯¿ê³  ê¸°íšŒë¥¼ ì¡ìœ¼ì‹­ì‹œì˜¤."
        elif oh_cg == OH_RELATE.get(ilgan_oh,{}).get("è¢«å‰‹") or oh_jj == OH_RELATE.get(ilgan_oh,{}).get("è¢«å‰‹"):
            synergy = "ğŸ“– ê´€ì„± ë°œë™ ëŒ€ìš´"
            detail = "ê´€ì„±ì´ ë°œë™í•˜ì—¬ ì§ì—…Â·ëª…ì˜ˆì˜ ê¸°íšŒê°€ ì˜µë‹ˆë‹¤."
        elif oh_cg == OH_RELATE.get(ilgan_oh,{}).get("å‰‹") or oh_jj == OH_RELATE.get(ilgan_oh,{}).get("å‰‹"):
            synergy = "ğŸ’° ì¬ì„± ë°œë™ ëŒ€ìš´"
            detail = "ì¬ì„±ì´ ë°œë™í•˜ì—¬ ì¬ë¬¼ ê¸°ìš´ì´ ì›€ì§ì…ë‹ˆë‹¤. íš¡ì¬ìˆ˜ê°€ ìˆìœ¼ë‚˜ ì¬ë¬¼ ê´€ë¦¬ì— ì‹ ì¤‘í•˜ì‹­ì‹œì˜¤."
        else:
            synergy = "âš¡ ë³€í™” ì‹œë ¨ ëŒ€ìš´"
            detail = "í‰ì„±ì´ ë°œë™í•˜ê¸° ì‰¬ìš´ ì‹œê¸°. ìš•ì‹¬ì„ ì¤„ì´ê³  ì„ í–‰ì„ ìŒ“ìœ¼ë©° ì¡°ìƒì‹ ê»˜ ê¸°ë„í•˜ì‹­ì‹œì˜¤."
        mark = "â–¶ã€í˜„ì¬ã€‘" if is_active else "ã€€ã€€ã€€ã€€"
        dw_lines.append(f"{mark}{d['age']}ì„¸({d['year']}~{d['year']+9}ë…„) {d['cg']}{d['jj']}ëŒ€ìš´ {synergy}\nã€€ {detail}")

    return f"""â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
ğŸŒŠ ëŒ€ìš´(å¤§é‹) â€” í•˜ëŠ˜ì´ 10ë…„ë§ˆë‹¤ ë³´ë‚´ëŠ” ê¸°ìš´
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”

ëŒ€ìš´(å¤§é‹)ì€ í•˜ëŠ˜ì´ 10ë…„ ì£¼ê¸°ë¡œ ë°”ê¾¸ì–´ ë³´ë‚´ëŠ” ì‚¶ì˜ í° ê¸°ìš´ì…ë‹ˆë‹¤. ë³µì„±(ç¦æ˜Ÿ)ì´ ë“œëŠ” í™©ê¸ˆ ëŒ€ìš´ì—ëŠ” ì¡°ìƒì‹ ì´ ê¸¸ì„ í™œì§ ì—´ì–´ì£¼ì‹œê³ , í‰ì„±(å‡¶æ˜Ÿ)ì´ ë°œë™í•˜ëŠ” ì‹œë ¨ ëŒ€ìš´ì—ëŠ” ë‚´ì‹¤ì„ ë‹¤ì§€ë©° ë‹¤ìŒ ë„ì•½ì„ ì¤€ë¹„í•´ì•¼ í•˜ëŠ” ê²ƒì´ í•˜ëŠ˜ì˜ ì´ì¹˜ì…ë‹ˆë‹¤.

{curr_section}

â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
ã€ì „ì²´ ëŒ€ìš´ íë¦„ â€” í•˜ëŠ˜ì´ í¼ì³ë‘” ì¸ìƒì˜ ì§€ë„ã€‘

{chr(10).join(dw_lines)}

ã€ëŒ€ìš´ í™œìš©ì˜ ë¹„ë°©(ç§˜æ–¹)ã€‘
ë³µì„±ì´ ë“œëŠ” í™©ê¸ˆ ëŒ€ìš´ì—ëŠ” ì˜¤ë«ë™ì•ˆ ì¤€ë¹„í•´ì˜¨ ì¼ì„ ê³¼ê°í•˜ê²Œ ê²°í–‰í•˜ì‹­ì‹œì˜¤. í‰ì„±ì´ ë°œë™í•˜ëŠ” ì‹œë ¨ ëŒ€ìš´ì—ëŠ” í•˜ëŠ˜ì´ ë‹¹ì‹ ì„ ë” í¬ê²Œ ì“°ê¸° ìœ„í•´ ì—°ë‹¨(éŠé›)í•˜ëŠ” ê³¼ì •ì„ì„ ë¯¿ìœ¼ì‹­ì‹œì˜¤. ìŒë ¥ ì´ˆí•˜ë£¨ì™€ ë³´ë¦„ì— ì¡°ìƒì‹ ê»˜ ê¸°ë„ë¥¼ ì˜¬ë¦¬ë©´ í‰ì„±ì´ ì•½í•´ì§€ê³  ë³µì„±ì´ ë¹¨ë¦¬ ëŒì•„ì˜µë‹ˆë‹¤.

â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
âš ï¸ ìì²´ ë¶„ì„ ëª¨ë“œ â€” Groq API í‚¤ ì…ë ¥ ì‹œ ë”ìš± ê¹Šì€ ì‹ ëª… í’€ì´ë¥¼ ë°›ìœ¼ì‹¤ ìˆ˜ ìˆìŠµë‹ˆë‹¤"""

def self_newyear(s, form):
    oh_cnt = s["oh_cnt"]
    yon = get_yongshin(s["ilgan"], oh_cnt)
    cy = datetime.now().year
    ci = ((cy - 4) % 10 + 10) % 10
    ji = ((cy - 4) % 12 + 12) % 12
    cyp = {"cg": CG[ci], "cgk": CG_KR[ci], "jj": JJ[ji], "jjk": JJ_KR[ji], "ani": JJ_AN[ji]}
    year_oh1 = OH.get(cyp["cg"], "")
    year_oh2 = OH.get(cyp["jj"], "")
    is_good_year = year_oh1 == yon["yongshin"] or year_oh2 == yon["yongshin"]
    seed = str_seed(s["ilgan"] + str(cy))
    months = ["1ì›”","2ì›”","3ì›”","4ì›”","5ì›”","6ì›”","7ì›”","8ì›”","9ì›”","10ì›”","11ì›”","12ì›”"]

    year_energy = {
        "æœ¨": "ìƒˆë¡œìš´ ì‹œì‘ê³¼ ìƒëª…ë ¥ì´ ì•½ë™í•˜ëŠ” ê¸°ìš´ì´ ê°•í•œ í•´. ì¡°ìƒì‹ ì´ ìƒˆë¡œìš´ ë¬¸ì„ ì—´ì–´ì£¼ì‹œëŠ” ì‹œê¸°ì…ë‹ˆë‹¤.",
        "ç«": "ì—´ì •ê³¼ ë³€í™”ì˜ ë¶ˆê½ƒì´ íƒ€ì˜¤ë¥´ëŠ” ê¸°ìš´ì´ ê°•í•œ í•´. í•˜ëŠ˜ì´ ì ê·¹ì ì¸ ë„ì „ì„ ì‘ì›í•˜ëŠ” ì‹œê¸°ì…ë‹ˆë‹¤.",
        "åœŸ": "ì•ˆì •ê³¼ ì‹ ì¤‘í•¨ì˜ ëŒ€ì§€ ê¸°ìš´ì´ ê°•í•œ í•´. ì¡°ìƒì‹ ì´ ë‚´ì‹¤ì„ ë‹¤ì§€ê¸°ë¥¼ ì›í•˜ì‹œëŠ” ì‹œê¸°ì…ë‹ˆë‹¤.",
        "é‡‘": "ê²°ë‹¨ê³¼ ë³€í˜ì˜ ê¸ˆ(é‡‘) ê¸°ìš´ì´ ê°•í•œ í•´. ë¶ˆí•„ìš”í•œ ê²ƒì„ ì •ë¦¬í•˜ê³  ìƒˆë¡­ê²Œ ë„ì•½í•˜ê¸°ë¥¼ ìš”ì²­í•˜ëŠ” ì‹œê¸°ì…ë‹ˆë‹¤.",
        "æ°´": "ê¹Šì€ ì§€í˜œì™€ ì„±ì°°ì˜ ìˆ˜(æ°´) ê¸°ìš´ì´ ê°•í•œ í•´. ì¡°ìƒì‹ ì´ ë‚´ë©´ì˜ ì„±ì¥ì„ ì´ë„ì‹œëŠ” ì¡°ìš©í•œ ì¤€ë¹„ì˜ ì‹œê¸°ì…ë‹ˆë‹¤."
    }.get(year_oh1 or year_oh2, "ë³€í™”ì™€ ì„±ì¥ì˜ ê¸°ìš´ì´ ê°•í•œ í•´ì…ë‹ˆë‹¤.")

    month_lines = []
    for i, m in enumerate(months):
        m_seed = seed + i
        luck = pick(["ë³µì„± ìƒìŠ¹","ì•ˆì • íë¦„","ë³´í†µ ê¸°ìš´","ì£¼ì˜ ìš”ë§","ë„ì•½ ê¸°íšŒ"], m_seed)
        focus = pick(["ì¬ë¬¼Â·íš¡ì¬ìˆ˜","ê·€ì¸Â·ì¸ì—°","ì§ì—…Â·ì²œì§","ê±´ê°•Â·ì•¡ë§‰ì´","ìƒˆë¡œìš´ ì‹œì‘","ë‚´ì‹¤Â·ì¤€ë¹„"], m_seed + 1)
        month_lines.append(f"{m}: {luck} â€” {focus}ì— í•˜ëŠ˜ì˜ ê¸°ìš´ì´ ì§‘ì¤‘")

    keyword = pick(["ë„ì „","ê²°ì‹¤","ê·€ì¸","íš¡ì¬","ë„ì•½"], seed) if is_good_year else pick(["ì¸ë‚´","ë‚´ê³µ","ì¤€ë¹„","ê¸°ë„","ì„ í–‰"], seed)

    return f"""â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
ğŸŠ {cy}ë…„ ì‹ ë…„ìš´ì„¸ â€” í•˜ëŠ˜ì´ ì´ í•´ì— ë‹´ì•„ë‘” ê¸°ìš´
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”

ã€{cy}ë…„ ì„¸ìš´(æ­²é‹)ã€‘
{cy}ë…„ì€ {cyp['cg']}({cyp['cgk']}) {cyp['jj']}({cyp['jjk']}) ë…„, {cyp['ani']}ì˜ í•´ì…ë‹ˆë‹¤.
ì˜¬í•´ëŠ” {year_energy}

{"ğŸŒŸ ì˜¬í•´ëŠ” ìš©ì‹ ì˜ ê¸°ìš´ì´ ì„¸ìš´ê³¼ ë§ì•„ë–¨ì–´ì§€ëŠ” ë³µì„±(ç¦æ˜Ÿ)ì˜ í•´ì…ë‹ˆë‹¤! ì¡°ìƒì‹ ì´ í•œ í•´ ë‚´ë‚´ ê°•í•˜ê²Œ ë„ìš°ì‹œëŠ” í™©ê¸ˆ ì„¸ìš´ì…ë‹ˆë‹¤. ê·¸ë™ì•ˆ ê¸°ë‹¤ë ¤ì™”ë˜ ì¼ì„ ê²°í–‰í•˜ê³  ì˜¤ë«ë™ì•ˆ í’ˆì–´ì˜¨ ê¿ˆì„ í–¥í•´ í˜ì°¨ê²Œ ë‚˜ì•„ê°€ì‹­ì‹œì˜¤. ëœ»ë°–ì˜ íš¡ì¬ìˆ˜ê°€ ë°œë™í•  ìˆ˜ ìˆëŠ” ì†Œì¤‘í•œ í•œ í•´ì…ë‹ˆë‹¤." if is_good_year else "ì˜¬í•´ ì„¸ìš´ì´ ê¸°ì‹ (å¿Œç¥)ì— ê°€ê¹Œìš´ ê¸°ìš´ìœ¼ë¡œ í˜ëŸ¬ ì „ë°˜ì ìœ¼ë¡œ ì‹ ì¤‘í•œ ìì„¸ê°€ í•„ìš”í•©ë‹ˆë‹¤. ì¡°ìƒì‹ ê»˜ ê¸°ë„ë¥¼ ì˜¬ë¦¬ê³  ì„ í–‰ì„ ìŒ“ìœ¼ë©´ í‰ì„±ì´ ë¬¼ëŸ¬ê°€ê³  ë³µì„±ì´ ë” ë¹¨ë¦¬ ì°¾ì•„ì˜µë‹ˆë‹¤."}

ã€ì›”ë³„ í•˜ëŠ˜ì˜ ê¸°ìš´ã€‘
{chr(10).join(month_lines)}

ã€ì˜¬í•´ ì¡°ìƒì‹ ì˜ í•µì‹¬ ë©”ì‹œì§€ã€‘
ì˜¬í•´ í‚¤ì›Œë“œ: "{keyword}"
ì´ í•œ í•´ ì´ í‚¤ì›Œë“œë¥¼ ê°€ìŠ´ì— í’ˆê³  ì¡°ìƒì‹ ì˜ ëœ»ì— ìˆœì‘í•˜ë©° ì‚´ì•„ê°„ë‹¤ë©´ ì—°ë§ì— í’ì„±í•œ ê²°ì‹¤ì„ ê±°ë‘ê²Œ ë  ê²ƒì…ë‹ˆë‹¤.

í–‰ìš´ì˜ ë°©í–¥: {OH_DIR.get(yon['yongshin'], 'ë™ìª½')} Â· í–‰ìš´ì˜ ìƒ‰ìƒ: {OH_COLOR_MAP.get(yon['yongshin'], 'ë‹¤ì–‘í•œ ìƒ‰ìƒ')} Â· í–‰ìš´ì˜ ìˆ«ì: {OH_NUM.get(yon['yongshin'], '1, 5')}

â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
âš ï¸ ìì²´ ë¶„ì„ ëª¨ë“œ â€” Groq API í‚¤ ì…ë ¥ ì‹œ ë”ìš± ê¹Šì€ ì‹ ëª… í’€ì´ë¥¼ ë°›ìœ¼ì‹¤ ìˆ˜ ìˆìŠµë‹ˆë‹¤"""

def self_daily(s, form):
    today = datetime.now()
    wd = ["ì¼","ì›”","í™”","ìˆ˜","ëª©","ê¸ˆ","í† "][today.weekday() + 1 if today.weekday() < 6 else 0]
    # Python weekday(): Mon=0..Sun=6, KR: Sun=ì¼,Mon=ì›”...
    wd_map = {0:"ì›”",1:"í™”",2:"ìˆ˜",3:"ëª©",4:"ê¸ˆ",5:"í† ",6:"ì¼"}
    wd = wd_map[today.weekday()]
    seed = today.year*10000 + today.month*100 + today.day + str_seed(s["ilgan"])
    yon = get_yongshin(s["ilgan"], s["oh_cnt"])

    luck = pick(["í™œê¸°ì°¬ ì—ë„ˆì§€ê°€ ë„˜ì¹˜ëŠ”","í‰ì˜¨í•˜ê³  ì•ˆì •ì ì¸","ìƒˆë¡œìš´ ê¸°íšŒê°€ ì—´ë¦¬ëŠ”","ì‹ ì¤‘í•œ íŒë‹¨ì´ í•„ìš”í•œ","ê¸ì •ì ì¸ ë³€í™”ê°€ ê¸°ë‹¤ë¦¬ëŠ”"], seed)
    do_it = pick(["ì¤‘ìš”í•œ ì—°ë½ì´ë‚˜ ë¯¸íŒ… ì§„í–‰","ìƒˆë¡œìš´ ì•„ì´ë””ì–´ ë©”ëª¨Â·ê¸°íš","ì¸ê°„ê´€ê³„ ì±™ê¸°ê¸°Â·ê°ì‚¬ ì¸ì‚¬","ì§‘ì¤‘ì´ í•„ìš”í•œ í•µì‹¬ ì—…ë¬´","ì¬ì • ì ê²€Â·ê³„íš ìˆ˜ë¦½"], seed+1)
    avoid = pick(["ì¶©ë™ì ì¸ ê²°ì •ê³¼ ì¦‰í¥ í–‰ë™","ë¶ˆí•„ìš”í•œ ê°ì •ì  ëŒ€ì‘","í° ê¸ˆì•¡ì˜ ì§€ì¶œÂ·íˆ¬ì","ë¬´ë¦¬í•œ ì•½ì†Â·ê³¼ë„í•œ ê³„íš","ì¤‘ìš” ê³„ì•½Â·ì„œë¥˜ ì„œëª…"], seed+2)
    color = (OH_COLOR_MAP.get(yon["yongshin"],"ë‹¤ì–‘í•œ ìƒ‰ìƒ").split(",")[0]).strip()
    num = (OH_NUM.get(yon["yongshin"],"1, 5").split(",")[0]).strip()
    direction = OH_DIR.get(yon["yongshin"], "ë™ìª½")
    day_type = pick(["ì¡°ìƒì‹ ì˜ ê¸°ìš´ì´ ì™•ì„±í•œ ë‚  â€” ê¸°ë„ì™€ ê°ì‚¬ë¥¼ ì˜¬ë¦¬ë©´ ë³µì´ ë°°ê°€ ë©ë‹ˆë‹¤","ê·€ì¸ì˜ ì¸ì—°ì´ ì›€ì§ì´ëŠ” ë‚  â€” ë§Œë‚¨ê³¼ ì—°ë½ì— ì¡°ìƒì‹ ì˜ ëœ»ì´ ë‹´ê²¨ ìˆìŠµë‹ˆë‹¤","ì²œì§ì˜ ì‹ ëª…ì´ ë°œë™í•˜ëŠ” ë‚  â€” ì§‘ì¤‘ë ¥ ìˆê²Œ ì¼í•˜ë©´ ë³µì„±ì´ ë„ì›ë‹ˆë‹¤","ë‚´ì‹¤ì„ ë‹¤ì§€ëŠ” ë‚  â€” ìš•ì‹¬ì„ ì¤„ì´ê³  ê°ì‚¬íˆ ë¨¸ë¬´ëŠ” ê²ƒì´ í•˜ëŠ˜ì˜ ëœ»ì…ë‹ˆë‹¤"], seed+7)
    msg = pick([
        "ì˜¤ëŠ˜ í•˜ë£¨, ì¡°ìƒì‹ ì´ ë‹¹ì‹  ê³ì—ì„œ ê¸¸ì„ ë°íˆê³  ìˆìŠµë‹ˆë‹¤. ê°ì‚¬í•œ ë§ˆìŒìœ¼ë¡œ ë‚˜ì•„ê°€ì‹­ì‹œì˜¤ ğŸ™",
        "ì‘ì€ ì„ í–‰ì´ í•˜ëŠ˜ì˜ ë³µì„ ì—´ì–´ì¤ë‹ˆë‹¤. ì˜¤ëŠ˜ í•œ ì‚¬ëŒì—ê²Œ ë”°ëœ»í•¨ì„ ë² í‘¸ì‹­ì‹œì˜¤ âœ¨",
        "í•˜ëŠ˜ì´ ë‚´ë¦° ì˜¤ëŠ˜, ë‹¹ì‹ ì˜ ì‹ ëª…(ç¥å‘½)ì´ ì¶©ë§Œí•©ë‹ˆë‹¤. ë¯¿ê³  ë‚˜ì•„ê°€ì‹­ì‹œì˜¤ ğŸŒŸ",
        "ë³´ì´ì§€ ì•ŠëŠ” ì†ê¸¸ì´ ì˜¤ëŠ˜ë„ ë‹¹ì‹ ì„ ì´ëŒê³  ìˆìŠµë‹ˆë‹¤. ë‘ë ¤ì›€ ì—†ì´ ê±¸ì–´ê°€ì‹­ì‹œì˜¤ ğŸ’«",
    ], seed+6)

    return f"""ğŸ“… {today.year}ë…„ {today.month}ì›” {today.day}ì¼ ({wd}ìš”ì¼)

ğŸ”® ì˜¤ëŠ˜ì˜ í•˜ëŠ˜ ê¸°ìš´
í•˜ëŠ˜ì´ ì˜¤ëŠ˜ {s['ilgan']}({s['ilgan_kr']}) ì¼ê°„ì—ê²Œ ë³´ë‚´ëŠ” ê¸°ìš´ì€ {luck} ê¸°ìš´ì…ë‹ˆë‹¤.
ì˜¤ëŠ˜ì€ {day_type}

âœ… ì˜¤ëŠ˜ í•˜ëŠ˜ì´ ê¶Œí•˜ëŠ” ê²ƒ: {do_it}
âš ï¸ ì˜¤ëŠ˜ ê¸°ì‹ ì´ ë°œë™í•˜ëŠ” ê²ƒ: {avoid}

ğŸ€ ê¸¸ë°©Â·ê¸¸ìƒ‰Â·ê¸¸ìˆ˜
ìƒ‰ìƒ: {color} Â· ìˆ«ì: {num} Â· ë°©í–¥: {direction}

ğŸ™ ì¡°ìƒì‹ ì˜ ë§ì”€
{msg}"""

def self_general(tab_id, s, form):
    oh_cnt = s["oh_cnt"]
    analysis = get_oh_analysis(oh_cnt)
    strong, weak = analysis["strong"], analysis["weak"]
    yon = get_yongshin(s["ilgan"], oh_cnt)
    ilgan_d = ILGAN_DESC.get(s["ilgan"], ILGAN_DESC["ç”²"])
    seed = str_seed(s["ilgan"] + tab_id + str(s["birth_year"]))
    gender = "ë‚¨ì„±" if form.get("gender") == "male" else "ì—¬ì„±"
    marital = MKR.get(form.get("marital","single"), "ë¯¸í˜¼")
    job_label = JKR.get(form.get("job",""), "ì§ì¥ì¸")
    ilgan_oh = OH.get(s["ilgan"], "æœ¨")

    CONTENT = {
        "business": f"""í•˜ëŠ˜ì´ ì´ ì‚¬ì£¼ì— ì‚¬ì—…ì˜ ì²œë³µ(å¤©ç¦)ì„ ì–´ë–»ê²Œ ì ì§€í–ˆëŠ”ì§€ ì‚´í´ë´…ë‹ˆë‹¤. {s['ilgan']}({s['ilgan_kr']}) ì¼ê°„ì˜ ì‚¬ì—… ê¸¸ë°©(å‰æ–¹)ì€ ì¡°ìƒì‹ ì˜ ê°€í˜¸ê°€ ê°€ì¥ ê°•í•˜ê²Œ ë¯¸ì¹˜ëŠ” ë¶„ì•¼ì¸ {ilgan_d['career']}ì…ë‹ˆë‹¤.

ì‚¬ì—… í™•ì¥ì˜ í™©ê¸ˆ ì‹œê¸°ëŠ” ë³µì„±ì´ ì¶©ë§Œí•œ {OH_SEASON.get(yon['yongshin'], 'ë´„')}ì…ë‹ˆë‹¤. ì´ ì‹œê¸°ì— ê³¼ê°íˆ ê²°í–‰í•˜ë©´ ì¡°ìƒì‹ ì´ ë’¤ë¥¼ ë°›ì³ì£¼ì‹­ë‹ˆë‹¤. ê¸°ì‹  ê¸°ìš´ì´ ê°•í•œ ì‹œê¸°ì—ëŠ” ë‚´ì‹¤ì„ ë‹¤ì§€ëŠ” ê²ƒì´ í•˜ëŠ˜ì˜ ëœ»ì…ë‹ˆë‹¤.

ë™ì—…ì€ í•˜ëŠ˜ì´ ì¸ì—°ìœ¼ë¡œ ë§ºì–´ì¤€ ì‚¬ëŒê³¼ í•´ì•¼ í•©ë‹ˆë‹¤. ìƒëŒ€ì˜ ê¸°ìš´ì´ ë‚´ ì‚¬ì£¼ì™€ ìƒìƒ(ç›¸ç”Ÿ)í•˜ëŠ”ì§€ ë°˜ë“œì‹œ ì‚´í”¼ê³ , ê³„ì•½ì„œì™€ ëª…í™•í•œ ì—­í•  ë¶„ë‹´ìœ¼ë¡œ í•˜ëŠ˜ì˜ ì¦ì¸ì„ ë‘ì‹­ì‹œì˜¤. ì‚¬ì—…ì¥ì˜ ë°©í–¥ì„ {OH_DIR.get(yon['yongshin'], 'ë™ìª½')}ìœ¼ë¡œ ì¡ê³ , í–‰ìš´ì˜ ìƒ‰ìƒ {OH_COLOR_MAP.get(yon['yongshin'], 'ë‹¤ì–‘í•œ ìƒ‰ìƒ')}ê³¼ ìˆ«ì {OH_NUM.get(yon['yongshin'], '1, 5')}ë¥¼ ì‚¬ì—…ì— í™œìš©í•˜ë©´ ì¡°ìƒì‹ ì˜ ìŒë•ì´ ë”ìš± ê°•í•˜ê²Œ ë°œë™í•©ë‹ˆë‹¤.""",
        "accident": f"""ì‚¬ê³ ìˆ˜(äº‹æ•…æ•¸)ì™€ ìœ„í—˜ìš´ì€ ê¸°ì‹  ì˜¤í–‰ì´ ê°•í•´ì§€ëŠ” ì‹œê¸°ì— í‰ì„±(å‡¶æ˜Ÿ)ì´ ë°œë™í•˜ë©´ì„œ ë‚˜íƒ€ë‚©ë‹ˆë‹¤. ì´ ì‚¬ì£¼ì—ì„œ íŠ¹ë³„íˆ ì£¼ì˜í•´ì•¼ í•  ë¶€ìœ„ëŠ” {ilgan_d['health'].split('.')[0]}ì…ë‹ˆë‹¤.

í‰ì„±ì´ ë°œë™í•˜ê¸° ì‰¬ìš´ ì‹œê¸°ëŠ” {', '.join(OH_SEASON.get(k,'í™˜ì ˆê¸°') for k in weak) if weak else 'í™˜ì ˆê¸°'}ì…ë‹ˆë‹¤. ì´ ì‹œê¸°ì—ëŠ” êµí†µì‚¬ê³ , ë‚™ìƒ, ì™¸ìƒì— ê°ë³„íˆ ì¡°ì‹¬í•˜ê³ , ìƒˆë²½ ê¸°ë„ë¡œ ì¡°ìƒì‹ ê»˜ í‰ì•ˆì„ êµ¬í•˜ëŠ” ê²ƒì´ ì•¡ìš´ì„ ë¬¼ë¦¬ì¹˜ëŠ” ë¹„ë°©(ç§˜æ–¹)ì…ë‹ˆë‹¤.

ì•¡ë§‰ì´ì˜ ì„¸ ê°€ì§€ ë¹„ë°©: ì²«ì§¸, ìŒë ¥ ì´ˆí•˜ë£¨ì™€ ë³´ë¦„ì— ì²­ìˆ˜(ë§‘ì€ ë¬¼)ë¥¼ ì˜¬ë¦¬ê³  ë¶ë‘ì¹ ì„±ë‹˜ê»˜ êµí†µê³¼ ì‹ ë³€ ì•ˆì „ì„ ê¸°ì›í•˜ì‹­ì‹œì˜¤. ë‘˜ì§¸, ìš©ì‹  ê¸°ìš´ì¸ {OHN.get(yon['yongshin'], 'ê· í˜•')}ê³¼ ì—°ê²°ëœ ìƒ‰ìƒì˜ ì†Œí’ˆì„ ëª¸ì— ì§€ë‹ˆë©´ ê¸°ì‹ ì˜ í‰ì„±ì„ ì–µì œí•©ë‹ˆë‹¤. ì…‹ì§¸, ìœ„í—˜í•œ ì‹œê¸°ì—ëŠ” ìƒˆë²½ ê¸°ë„ì™€ ì„ í–‰ì„ ìŒ“ì•„ í•˜ëŠ˜ì˜ ë³´í˜¸ë§‰ì„ ê°•í™”í•˜ì‹­ì‹œì˜¤.""",
        "marriage": f"""í•˜ëŠ˜ì´ ë¶‰ì€ ì‹¤ë¡œ ì •í•´ë‘” ë°°í•„ê³¼ì˜ ì¸ì—°ì„ ì‚¬ì£¼íŒ”ìë¡œ ì‚´í´ë´…ë‹ˆë‹¤. {gender}ì¸ {s['ilgan']}({s['ilgan_kr']}) ì¼ê°„ì˜ ë°°ìš°ì ìë¦¬ì¸ ì¼ì§€(æ—¥æ”¯) {s['pillars'][1]['jj']}({s['pillars'][1]['jjk']})ì—ëŠ” {JJ_CHAR.get(s['pillars'][1]['jj'], 'ê°•í•œ ê¸°ìš´ì˜')} ì²œìƒì—°ë¶„ì´ ìƒˆê²¨ì ¸ ìˆìŠµë‹ˆë‹¤.

{marital} ìƒíƒœì¸ í˜„ì¬, {
"í•˜ëŠ˜ì´ ì´ë¯¸ ì •í•´ë‘” ì¸ì—°ì´ ë•Œë¥¼ ê¸°ë‹¤ë¦¬ê³  ìˆìŠµë‹ˆë‹¤. ê²°í˜¼ ê¸¸ì‹œ(å‰æ™‚)ëŠ” ë³µì„±ì´ ê°•í•˜ê²Œ ë“œëŠ” " + OH_SEASON.get(yon['yongshin'], 'ë´„') + "ì´ë©°, ìŒë ¥ ì´ˆí•˜ë£¨ì— ì¡°ìƒì‹ ê»˜ ì¢‹ì€ ì¸ì—°ì„ ê¸°ì›í•˜ëŠ” ê¸°ë„ë¥¼ ì˜¬ë¦¬ë©´ í•˜ëŠ˜ì´ ê¸¸ì„ ì—´ì–´ì£¼ì‹­ë‹ˆë‹¤." if form.get('marital') == 'single' else
"í•˜ëŠ˜ì´ ë§ºì–´ì¤€ ì†Œì¤‘í•œ ì¸ì—°ê³¼ í•¨ê»˜í•˜ê³  ìˆìŠµë‹ˆë‹¤. ê¸°ì‹  ê¸°ìš´ì´ ê°•í•œ ì‹œê¸°ì—ëŠ” ë”ìš± ë°°ë ¤ì™€ ì¸ë‚´ì‹¬ìœ¼ë¡œ ìƒëŒ€ë°©ì„ ëŒ€í•˜ì‹­ì‹œì˜¤. ë¶€ë¶€ê°€ í•¨ê»˜ ì¡°ìƒì‹ ê»˜ ê°ì‚¬ì˜ ê¸°ë„ë¥¼ ì˜¬ë¦¬ë©´ ê°€ì •ì— ë³µì„±ì´ ë”ìš± ì¶©ë§Œí•´ì§‘ë‹ˆë‹¤." if form.get('marital') == 'married' else
"í•˜ëŠ˜ì€ ìƒˆë¡œìš´ ì¸ì—°ì˜ ì”¨ì•—ì„ ì´ë¯¸ ì¤€ë¹„í•´ë‘ì—ˆìŠµë‹ˆë‹¤. ê³¼ê±°ì˜ ìƒì²˜ë¥¼ ì¹˜ìœ í•˜ê³  ìŠ¤ìŠ¤ë¡œë¥¼ ì‚¬ë‘í•  ë•Œ, ì¡°ìƒì‹ ì´ ë”ìš± ê¹Šê³  ì„±ìˆ™í•œ ì²œìƒì—°ë¶„ì„ ì´ëŒì–´ì£¼ì‹­ë‹ˆë‹¤."}""",
        "samjae": f"""ì‚¼ì¬(ä¸‰ç½)ëŠ” í•˜ëŠ˜ì´ 12ë…„ë§ˆë‹¤ 3ë…„ê°„ ë‚´ë¦¬ëŠ” ì‹œë ¨ì˜ ê¸°ìš´ìœ¼ë¡œ, ë“¤ì‚¼ì¬Â·ëˆŒì‚¼ì¬Â·ë‚ ì‚¼ì¬ë¡œ ë‚˜ë‰©ë‹ˆë‹¤. ì´ê²ƒì€ ë²Œì´ ì•„ë‹ˆë¼ í•˜ëŠ˜ì´ ë” í¬ê²Œ ì“°ê¸° ìœ„í•´ ì˜í˜¼ì„ ì—°ë‹¨(éŠé›)í•˜ëŠ” ê³¼ì •ì…ë‹ˆë‹¤.

{s['birth_year']}ë…„ìƒ {s['year_pillar']['ani']}ë ì¸ ë‹¹ì‹ ì˜ ì‚¼ì¬ëŠ” 12ë…„ì˜ ìˆœí™˜ ì†ì—ì„œ ëŒì•„ì˜µë‹ˆë‹¤.

ì‚¼ì¬ë¥¼ ê·¹ë³µí•˜ëŠ” ì˜ì  ë¹„ë°©: ì²«ì§¸, ì‚¼ì¬ ê¸°ê°„ì—ëŠ” ìƒˆë²½ 5ì‹œ~7ì‹œ ì‚¬ì´ ì •ì„±ê» ì”»ê³  ë¶ìª½ì„ í–¥í•´ ì²­ìˆ˜ë¥¼ ì˜¬ë¦¬ë©° "ì¹ ì„±ë‹˜, ì¡°ìƒë‹˜, ì´ ëª¸ì˜ ì‚¼ì¬ë¥¼ ë¬¼ë¦¬ì³ ì£¼ì‹œê³  í‰ì•ˆì„ ë‚´ë ¤ì£¼ì†Œì„œ"ë¼ê³  ê¸°ì›í•˜ì‹­ì‹œì˜¤. ë‘˜ì§¸, ë¬´ë¦¬í•œ íˆ¬ìì™€ ë³´ì¦ì„ ì‚¼ê°€ì‹­ì‹œì˜¤. ì…‹ì§¸, ì„ í–‰ì„ ìŒ“ê³  ì¡°ìƒì‹ ê»˜ ì§€ê·¹í•œ ê¸°ë„ë¥¼ ì˜¬ë¦¬ëŠ” ê²ƒì´ ì‚¼ì¬ë¥¼ ê°€ì¥ ê·¼ë³¸ì ìœ¼ë¡œ í•´ì†Œí•˜ëŠ” ë°©ë²•ì…ë‹ˆë‹¤.""",
        "protection": f"""ì•¡ìš´(å„é‹)ì´ë€ ê¸°ì‹ (å¿Œç¥) ì˜¤í–‰ì´ ê°•í•´ì§€ëŠ” ì‹œê¸° ë˜ëŠ” ì¶©(æ²–)Â·í˜•(åˆ‘)ì˜ ê¸°ìš´ì´ ë°œë™í•  ë•Œ ì°¾ì•„ì˜¤ëŠ” í‰ì„±(å‡¶æ˜Ÿ)ì˜ ê¸°ìš´ì…ë‹ˆë‹¤.

ì˜ˆë¡œë¶€í„° ì „í•´ì§€ëŠ” ì•¡ë§‰ì´ ë¹„ë°©ì„ ì†Œê°œí•©ë‹ˆë‹¤.
ì²«ì§¸, ë¶ë‘ì¹ ì„± ê¸°ë„ë²•: ìŒë ¥ ì´ˆí•˜ë£¨ì™€ ë³´ë¦„ë‚  ìƒˆë²½, ì²­ìˆ˜(ë§‘ì€ ë¬¼)ë¥¼ ì •ì„±ê» ì˜¬ë¦¬ê³  ë¶ìª½ì„ í–¥í•´ "ì•¡ìš´ì€ ë¬¼ëŸ¬ê°€ê³  ë³µìš´ì€ ê°€ë“ ë“¤ì–´ì˜¤ì†Œì„œ"ë¼ëŠ” ê¸°ì›ì„ ì˜¬ë¦¬ì‹­ì‹œì˜¤.
ë‘˜ì§¸, ìš©ì‹  ë°©í–¥ ê¸°ë„ë²•: ìš©ì‹  ë°©í–¥ì¸ {OH_DIR.get(yon['yongshin'], 'ë™ìª½')}ì„ í–¥í•´ ì¤‘ìš”í•œ ì¼ì„ í–‰í•˜ê³ , ì† ì—†ëŠ” ë‚ (å‰æ—¥)ì„ í™œìš©í•˜ë©´ ì¡°ìƒì‹ ì˜ ë„ì›€ì´ ê°•í•´ì§‘ë‹ˆë‹¤.
ì…‹ì§¸, ìš©ì‹  ìƒ‰ìƒì¸ {OH_COLOR_MAP.get(yon['yongshin'], 'ë‹¤ì–‘í•œ ìƒ‰ìƒ')}ì„ ëª¸ì— ê°€ê¹Œì´ í•˜ë©´ ê¸°ì‹ ì˜ í‰ì„±ì„ ì–µì œí•˜ê³  ë³µì„±ì„ ë¶ˆëŸ¬ë“¤ì´ëŠ” íš¨ê³¼ê°€ ìˆìŠµë‹ˆë‹¤.
ë„·ì§¸, ì„ í–‰ì„ ê¾¸ì¤€íˆ ìŒ“ìœ¼ì‹­ì‹œì˜¤. í•˜ëŠ˜ì€ ë•ì„ í–‰í•˜ëŠ” ìì˜ ì•¡ìš´ì„ ê°€ë³ê²Œ í•˜ì‹œê³  ë³µì˜ ê¸°ìš´ì„ ë”í•˜ì‹­ë‹ˆë‹¤.""",
        "study": f"""í•™ì—…ê³¼ ì‹œí—˜ìš´ì€ ì‚¬ì£¼ì—ì„œ ì¸ì„±(å°æ˜Ÿ)ì˜ ê¸°ìš´ì„ í†µí•´ íŒŒì•…í•©ë‹ˆë‹¤. {s['ilgan']}({s['ilgan_kr']}) ì¼ê°„ì˜ ì¸ì„±ì€ {OH_RELATE.get(ilgan_oh, {}).get('ç”Ÿ', '')}({OHN.get(OH_RELATE.get(ilgan_oh, {}).get('ç”Ÿ', ''), 'ê· í˜•')}) ê¸°ìš´ì…ë‹ˆë‹¤.

ì¸ì„± ê¸°ìš´ ë¶„ì„: {
"ì¸ì„±ì´ ì‚¬ì£¼ì— ë‘í…ê²Œ ìë¦¬í•˜ê³  ìˆìŠµë‹ˆë‹¤. í•˜ëŠ˜ì´ ì§€ì‹ì˜ ë³µì„ í’ì„±í•˜ê²Œ ë‚´ë ¤ì£¼ì…¨ìœ¼ë‹ˆ ê¾¸ì¤€íˆ ê³µë¶€í•˜ë©´ ë°˜ë“œì‹œ ê²°ì‹¤ì„ ë§ºëŠ” í•™ì—… ë³µì´ ìˆìŠµë‹ˆë‹¤." if oh_cnt.get(OH_RELATE.get(ilgan_oh, {}).get('ìƒ', ''), 0) >= 2 else
"ì¸ì„± ê¸°ìš´ì´ ë³´í†µ ìˆ˜ì¤€ì…ë‹ˆë‹¤. ê¾¸ì¤€í•œ ë…¸ë ¥ì„ í†µí•´ ì§€ì‹ì˜ ë³µì„ ìŒ“ìœ¼ë¼ê³  í•˜ëŠ˜ì´ ìš”êµ¬í•˜ì‹­ë‹ˆë‹¤." if oh_cnt.get(OH_RELATE.get(ilgan_oh, {}).get('ìƒ', ''), 0) == 1 else
"ì¸ì„± ê¸°ìš´ì´ ì•½í•œ í¸ì…ë‹ˆë‹¤. í•˜ëŠ˜ì´ ì•”ê¸°ë³´ë‹¤ ì´í•´ì™€ ì‘ìš©ìœ¼ë¡œ ì§€ì‹ì„ ìŒ“ìœ¼ë¼ê³  ìš”ì²­í•˜ì‹­ë‹ˆë‹¤. ì§§ì€ ì§‘ì¤‘ ê³µë¶€ì™€ ì¶©ë¶„í•œ íœ´ì‹ì„ ë°˜ë³µí•˜ëŠ” ë°©ì‹ì´ ì´ ì‚¬ì£¼ì— ì˜ ë§ìŠµë‹ˆë‹¤."}

ì‹œí—˜ ë³µì„±ì´ ê°€ì¥ ê°•í•˜ê²Œ ë°œë™í•˜ëŠ” ì‹œê¸°ëŠ” {OH_SEASON.get(OH_RELATE.get(ilgan_oh, {}).get('ç”Ÿ', ''), 'ë´„')}ì…ë‹ˆë‹¤. ê³µë¶€í•˜ê¸° ê¸¸í•œ ë°©í–¥ì€ {OH_DIR.get(OH_RELATE.get(ilgan_oh, {}).get('ç”Ÿ', ''), 'ë™ìª½')}ì´ë©°, ì±…ìƒì„ ì´ ë°©í–¥ìœ¼ë¡œ ë†“ìœ¼ë©´ ì§‘ì¤‘ë ¥ì˜ ì‹ ëª…ì´ ê¹¨ì–´ë‚©ë‹ˆë‹¤.""",
        "family": f"""ê°€ì¡±ì€ í•˜ëŠ˜ì´ ì´ ìƒì—ì„œ í•¨ê»˜í•˜ë„ë¡ ë§ºì–´ì¤€ ì˜ì  ì¸ì—°ì…ë‹ˆë‹¤.

ë¶€ëª¨ì™€ì˜ ì¸ì—°ì„ ë‚˜íƒ€ë‚´ëŠ” ì›”ì£¼ {s['pillars'][2]['cg']}{s['pillars'][2]['jj']}({s['pillars'][2]['cgk']}{s['pillars'][2]['jjk']})ë¥¼ ë³´ë©´, {
"ë¶€ëª¨ë¡œë¶€í„° ê°•í•œ ê¸°ìš´ì„ ì´ì–´ë°›ì€ êµ¬ì¡°ì…ë‹ˆë‹¤. ë¶€ëª¨ë‹˜ì˜ ìŒë•(è”­å¾·)ì´ ë‹¹ì‹  ì‚¶ì˜ ë“ ë“ í•œ ë¿Œë¦¬ë¥¼ ì´ë£¨ê³  ìˆìœ¼ë‹ˆ ê·¸ ì€í˜œì— ê¹Šì´ ê°ì‚¬í•˜ëŠ” ë§ˆìŒì´ ì¡°ìƒì‹ ì˜ ë³µì„ í™œì„±í™”í•©ë‹ˆë‹¤." if OH.get(s['pillars'][2]['cg']) == ilgan_oh or OH.get(s['pillars'][2]['jj']) == ilgan_oh else "ë¶€ëª¨ì™€ ë‹¤ë¥¸ ê¸°ìš´ìœ¼ë¡œ ë…ë¦½ì‹¬ì´ ê°•í•˜ê²Œ ë°œë‹¬í•œ êµ¬ì¡°ì…ë‹ˆë‹¤. ë¶€ëª¨ë‹˜ê³¼ì˜ ë‹¤ë¦„ì„ ë„˜ì–´ ê°ì‚¬í•œ ë§ˆìŒì„ í’ˆì„ ë•Œ ì¡°ìƒì˜ ìŒë•ì´ ê°•í•˜ê²Œ ë°œë™í•©ë‹ˆë‹¤."}

ê¸°ì‹  ê¸°ìš´ì´ ê°•í•œ ì‹œê¸°ì—ëŠ” ê°€ì¡± ê°„ì˜ ê°ˆë“±ì˜ í‰ì„±ì´ ë°œë™í•˜ê¸° ì‰½ìŠµë‹ˆë‹¤. ì´ ì‹œê¸°ì—ëŠ” ë”ìš± ë°°ë ¤ì™€ ì¸ë‚´ì‹¬ìœ¼ë¡œ ê°€ì¡±ì„ ëŒ€í•˜ê³ , ê°€ì¡±ì´ í•¨ê»˜ ì¡°ìƒì‹ ê»˜ ê°ì‚¬ë¥¼ ë“œë¦¬ëŠ” ê²ƒì´ ê°€ì •ì˜ ë³µì„ ì§€í‚¤ëŠ” ê°€ì¥ í™•ì‹¤í•œ ë°©ë²•ì…ë‹ˆë‹¤.""",
        "move": f"""ì´ì‚¬ì™€ ë¶€ë™ì‚°ì˜ ë³µì€ ì‚¬ì£¼ì—ì„œ í† ì„±(åœŸæ˜Ÿ)ê³¼ ì¬ì„±(è²¡æ˜Ÿ)ì˜ ê¸°ìš´ì´ ì£¼ê´€í•©ë‹ˆë‹¤. {s['ilgan']}({s['ilgan_kr']}) ì¼ê°„ì—ê²Œ í•˜ëŠ˜ì´ ì ì§€í•œ ì´ì‚¬ ê¸¸ë°©(å‰æ–¹)ì€ ìš©ì‹  ë°©í–¥ì¸ {OH_DIR.get(yon['yongshin'], 'ë™ìª½')}ì…ë‹ˆë‹¤.

ì´ì‚¬ ê¸¸ì‹œ(å‰æ™‚)ëŠ” ë³µì„±ì´ ë“œëŠ” {OH_SEASON.get(yon['yongshin'], 'ë´„')}ì´ë©°, ê¸°ì‹  ê¸°ìš´ì´ ê°•í•œ {OH_SEASON.get(weak[0], 'í™˜ì ˆê¸°') if weak else 'í™˜ì ˆê¸°'}ì—ëŠ” ê°€ê¸‰ì  ì´ì‚¬ë¥¼ í”¼í•˜ëŠ” ê²ƒì´ í•˜ëŠ˜ì˜ ëœ»ì— ë¶€í•©í•©ë‹ˆë‹¤.

ì´ì‚¬í•˜ëŠ” ë‚  ìƒˆ ì§‘ì—ì„œ ì¡°ìƒì‹ ê»˜ ì…ì£¼ë¥¼ ê³ í•˜ëŠ” ê¸°ë„ë¥¼ ì˜¬ë¦¬ë©´ ê°€ì •ì— ë³µì´ ì¶©ë§Œí•´ì§‘ë‹ˆë‹¤. ì•ˆë°©ì˜ ë°©í–¥ì„ ìš©ì‹  ë°©í–¥ì¸ {OH_DIR.get(yon['yongshin'], 'ë™ìª½')}ìœ¼ë¡œ ë°°ì¹˜í•˜ë©´ ì£¼ê±° ì‹ ëª…ì´ ê°•í•´ì§‘ë‹ˆë‹¤.""",
        "travel": f"""ì—¬í–‰ê³¼ ì´ë™ì€ ëª¸ì˜ ê¸°ìš´ì„ ìƒˆë¡­ê²Œ í•˜ê³  ì¡°ìƒì‹ ì˜ ê¸°ìš´ì„ ì¶©ì „í•˜ëŠ” ì¢‹ì€ ë°©ë²•ì…ë‹ˆë‹¤. {s['ilgan']}({s['ilgan_kr']}) ì¼ê°„ì—ê²Œ í•˜ëŠ˜ì´ ì ì§€í•œ ì—¬í–‰ ê¸¸ë°©(å‰æ–¹)ì€ ìš©ì‹  ë°©í–¥ì¸ {OH_DIR.get(yon['yongshin'], 'ë™ìª½')}ì…ë‹ˆë‹¤. ì´ ë°©í–¥ìœ¼ë¡œì˜ ì—¬í–‰ì€ ì‹ ëª…(èº«å‘½)ì„ ê°•í™”í•˜ê³  ìƒˆë¡œìš´ ê·€ì¸ ì¸ì—°ì„ ë§Œë‚˜ê²Œ í•˜ëŠ” ë³µì´ ìˆìŠµë‹ˆë‹¤.

ì—¬í–‰ ê¸¸ì‹œ(å‰æ™‚)ëŠ” ë³µì„±ì´ ì¶©ë§Œí•œ {OH_SEASON.get(yon['yongshin'], 'ë´„')}ì´ë©°, ê¸°ì‹  ê¸°ìš´ì´ ê°•í•œ ì‹œê¸°ì—ëŠ” ì¥ê±°ë¦¬ ì—¬í–‰ê³¼ ìœ„í—˜í•œ í™œë™ì„ ìì œí•˜ëŠ” ê²ƒì´ ì‚¬ê³ ìˆ˜ë¥¼ í”¼í•˜ëŠ” ë°©ë²•ì…ë‹ˆë‹¤. ì—¬í–‰ ì „ì— ì¡°ìƒì‹ ê»˜ ì•ˆì „í•œ ì—¬ì •ì„ ê¸°ì›í•˜ë©´ ê¸¸ ìœ„ì—ì„œë„ ë³´í˜¸ì˜ ê¸°ìš´ì´ í•¨ê»˜í•©ë‹ˆë‹¤.""",
        "friend": f"""ê·€ì¸(è²´äºº)ì€ í•˜ëŠ˜ì´ ë‹¹ì‹ ì˜ ì‚¶ì„ ë•ê¸° ìœ„í•´ ë³´ë‚´ì£¼ì‹œëŠ” íŠ¹ë³„í•œ ì¸ì—°ì…ë‹ˆë‹¤. {s['ilgan']}({s['ilgan_kr']}) ì¼ê°„ì—ê²Œ ê·€ì¸ì´ ì°¾ì•„ì˜¤ëŠ” ë°©í–¥ì€ {OH_DIR.get(yon['yongshin'], 'ë™ìª½')}ì´ë©°, {OHN.get(yon['yongshin'], 'ê· í˜•')} ê¸°ìš´ì´ ê°•í•œ ë¶„ì•¼ì— ì¢…ì‚¬í•˜ëŠ” ì‚¬ëŒì—ê²Œì„œ ê·€ì¸ì˜ ê¸°ìš´ì´ íë¥¼ ê°€ëŠ¥ì„±ì´ ë†’ìŠµë‹ˆë‹¤.

ë°˜ë©´ ê¸°ì‹  ê¸°ìš´ì´ ê°•í•œ {OH_SEASON.get(weak[0], 'í™˜ì ˆê¸°') if weak else 'í™˜ì ˆê¸°'}ì—ëŠ” ì†Œì¸ë°°ì™€ì˜ ê´€ê³„ì—ì„œ í‰ì„±ì´ ë°œë™í•˜ê¸° ì‰½ìŠµë‹ˆë‹¤.

ê·€ì¸ì„ ëŒì–´ë‹¹ê¸°ëŠ” ê°€ì¥ í™•ì‹¤í•œ ë¹„ë°©ì€ ë¨¼ì € ìì‹ ì´ ê·€ì¸ì´ ë˜ëŠ” ê²ƒì…ë‹ˆë‹¤. ì§„ì‹¬ìœ¼ë¡œ ë² í’€ê³  ì„ í–‰ì„ ìŒ“ìœ¼ë©´ ì¡°ìƒì‹ ì´ ê·¸ ë•ì— í™”ë‹µí•˜ì—¬ ê·€ì¸ì˜ ì¸ì—°ì„ ë³´ë‚´ì£¼ì‹­ë‹ˆë‹¤.""",
        "lawsuit": f"""ì†Œì†¡ê³¼ ê´€ì¬ìˆ˜(å®˜ç½æ•¸)ëŠ” ê¸°ì‹  ì˜¤í–‰ì´ ê³¼ë„í•´ì§€ê±°ë‚˜ ì¶©(æ²–)Â·í˜•(åˆ‘)ì˜ í‰ì„±ì´ ë°œë™í•  ë•Œ ë‚˜íƒ€ë‚©ë‹ˆë‹¤. {s['ilgan']}({s['ilgan_kr']}) ì¼ê°„ì—ê²Œ ê´€ì¬ í‰ì„±ì´ ë°œë™í•˜ê¸° ì‰¬ìš´ ì‹œê¸°ëŠ” ê¸°ì‹  ê¸°ìš´ì´ ê°•í•´ì§€ëŠ” {OH_SEASON.get(weak[0], 'í™˜ì ˆê¸°') if weak else 'í™˜ì ˆê¸°'}ì…ë‹ˆë‹¤.

í•˜ëŠ˜ì´ ê´€ì¬ì˜ í‰ì„±ì„ ë§‰ì•„ì£¼ë„ë¡ ê¸°ì›í•˜ëŠ” ë¹„ë°©: ì²«ì§¸, ëª¨ë“  ê³„ì•½ê³¼ ì•½ì†ì€ ë°˜ë“œì‹œ ë¬¸ì„œë¡œ ë‚¨ê¸°ê³  ì„œë¡œ ì¡°ì¸í•˜ì‹­ì‹œì˜¤. ë‘˜ì§¸, íƒ€ì¸ì˜ ì±„ë¬´ ë³´ì¦ì€ ì ˆëŒ€ ì„œì§€ ë§ˆì‹­ì‹œì˜¤. ì…‹ì§¸, ë¶„ìŸì´ ìƒê²¼ì„ ë•ŒëŠ” ê°ì •ì„ ë‹¤ìŠ¤ë¦¬ê³  ì „ë¬¸ê°€ì˜ ì¡°ì–¸ì„ êµ¬í•˜ì‹­ì‹œì˜¤.

ì†Œì†¡ìš´ì´ ë¶ˆë¦¬í•œ ì‹œê¸°ì— ë¶€ë“ì´í•˜ê²Œ ë²•ì  ë¬¸ì œê°€ ìƒê²¼ë‹¤ë©´, ìŒë ¥ ì´ˆí•˜ë£¨ì— ì²­ìˆ˜ë¥¼ ì˜¬ë¦¬ê³  ì¡°ìƒì‹ ê»˜ ì–µìš¸í•¨ì„ ê³ í•˜ë©° ê³µì •í•œ ê²°ê³¼ë¥¼ ê¸°ì›í•˜ì‹­ì‹œì˜¤.""",
    }

    tab_info = next((t for t in TABS if t["id"] == tab_id), {"label": tab_id, "icon": "âœ¦"})
    content = CONTENT.get(tab_id)
    if content:
        return f"""â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
{tab_info['icon']} {tab_info['label']} â€” í•˜ëŠ˜ì´ ì „í•˜ëŠ” ì‹ ëª…(ç¥å‘½)
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”

{content}

ê¸¸ë°©(å‰æ–¹): {OH_DIR.get(yon['yongshin'], 'ë™ìª½')} Â· ê¸¸ìƒ‰(å‰è‰²): {OH_COLOR_MAP.get(yon['yongshin'], 'ë‹¤ì–‘í•œ ìƒ‰ìƒ')} Â· ê¸¸ìˆ˜(å‰æ•¸): {OH_NUM.get(yon['yongshin'], '1, 5')}

â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
âš ï¸ ìì²´ ë¶„ì„ ëª¨ë“œ â€” Groq API í‚¤ ì…ë ¥ ì‹œ ë”ìš± ê¹Šì€ ì‹ ëª… í’€ì´ë¥¼ ë°›ìœ¼ì‹¤ ìˆ˜ ìˆìŠµë‹ˆë‹¤"""

    outlook = pick(["ë³µì„±ì´ ë“œëŠ” ì¢‹ì€ íë¦„","ì‹ ì¤‘í•¨ì´ í•„ìš”í•œ ì‹œê¸°","ë„ì•½ì˜ ê¸°ìš´ì´ ì˜¤ëŠ” ì‹œê¸°","ë‚´ì‹¤ì„ ë‹¤ì ¸ì•¼ í•  ì‹œê¸°"], seed)
    return f"""â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
{tab_info['icon']} {tab_info['label']} â€” í•˜ëŠ˜ì´ ì „í•˜ëŠ” ì‹ ëª…(ç¥å‘½)
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”

ã€í•˜ëŠ˜ì˜ ê¸°ìš´ã€‘
{s['ilgan']}({s['ilgan_kr']}) ì¼ê°„ì˜ {tab_info['label']}ì€ {outlook}ì…ë‹ˆë‹¤. ë³µì„±ì´ ê°•í•˜ê²Œ ë“œëŠ” {OH_SEASON.get(yon['yongshin'], 'ë´„')}ì´ ì¡°ìƒì‹ ì´ ê°€ì¥ ê°•í•˜ê²Œ ë„ìš°ì‹œëŠ” ì‹œê¸°ì´ë©°, ê¸¸ë°©(å‰æ–¹) {OH_DIR.get(yon['yongshin'], 'ë™ìª½')}ì˜ ê¸°ìš´ì„ í™œìš©í•˜ì—¬ ì‹ ëª…ì„ ë³´ê°•í•˜ì‹­ì‹œì˜¤.

ì‚¬ì£¼íŒ”ìëŠ” í•˜ëŠ˜ì´ ë‚´ë¦° ì²œëª…(å¤©å‘½)ì˜ ì§€ë„ì…ë‹ˆë‹¤. ì¡°ìƒì‹ ì˜ ìŒë•ì„ ë°›ë“¤ê³  ì„ í–‰ì„ ìŒ“ìœ¼ë©° í•˜ëŠ˜ì˜ ëœ»ì— ìˆœì‘í•˜ëŠ” ì‚¶ì´ ê°€ì¥ ë³µëœ ê¸¸ì…ë‹ˆë‹¤.

ê¸¸ë°©(å‰æ–¹): {OH_DIR.get(yon['yongshin'], 'ë™ìª½')} Â· ê¸¸ìƒ‰(å‰è‰²): {OH_COLOR_MAP.get(yon['yongshin'], 'ë‹¤ì–‘í•œ ìƒ‰ìƒ')} Â· ê¸¸ìˆ˜(å‰æ•¸): {OH_NUM.get(yon['yongshin'], '1, 5')}

â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
âš ï¸ ìì²´ ë¶„ì„ ëª¨ë“œ â€” Groq API í‚¤ ì…ë ¥ ì‹œ ë”ìš± ê¹Šì€ ì‹ ëª… í’€ì´ë¥¼ ë°›ìœ¼ì‹¤ ìˆ˜ ìˆìŠµë‹ˆë‹¤"""

def get_self_fortune(tab_id, saju, form):
    if tab_id == "overall":   return self_overall(saju, form)
    if tab_id == "wealth":    return self_wealth(saju, form)
    if tab_id == "love":      return self_love(saju, form)
    if tab_id == "health":    return self_health(saju, form)
    if tab_id == "career":    return self_career(saju, form)
    if tab_id == "daewoon":   return self_daewoon(saju, form)
    if tab_id == "newyear":   return self_newyear(saju, form)
    if tab_id == "daily":     return self_daily(saju, form)
    return self_general(tab_id, saju, form)

# â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
#  Groq API
# â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
GROQ_MODELS = ["meta-llama/llama-4-maverick-17b-128e-instruct", "llama-3.3-70b-versatile"]

def build_prompt(tab_id, saju, form):
    p = saju["pillars"]
    saju_text = f"ë…„ì£¼:{p[3]['cg']}{p[3]['jj']}({p[3]['cgk']}{p[3]['jjk']}), ì›”ì£¼:{p[2]['cg']}{p[2]['jj']}({p[2]['cgk']}{p[2]['jjk']}), ì¼ì£¼:{p[1]['cg']}{p[1]['jj']}({p[1]['cgk']}{p[1]['jjk']}), ì‹œì£¼:{p[0]['cg']}{p[0]['jj']}({p[0]['cgk']}{p[0]['jjk']})"
    oh_text = ", ".join(f"{OHE[k]}{OHN[k]}({k}):{v}ê°œ" for k,v in saju["oh_cnt"].items())
    personal = f"ì„±ë³„:{'ë‚¨ì„±' if form.get('gender')=='male' else 'ì—¬ì„±'}, ê²°í˜¼:{ MKR.get(form.get('marital','single'),'ë¯¸í˜¼')}, ì§ì—…:{JKR.get(form.get('job',''),'ì§ì¥ì¸')}"
    tab_info = next((t for t in TABS if t["id"] == tab_id), {"label": tab_id})
    yon = get_yongshin(saju["ilgan"], saju["oh_cnt"])

    guides = {
        "overall": "ì‚¬ì£¼íŒ”ì ì „ì²´ì˜ ì²œëª…(å¤©å‘½), ì¡°ìƒì‹ ì˜ ìŒë•, ì‹ ëª…ì˜ êµ¬ì¡°, ì˜¤í–‰ê³¼ ìš©ì‹ , ëŒ€ìš´ íë¦„, ì¬ë¬¼Â·ì§ì—…Â·ê±´ê°•Â·ì¸ì—°ìš´ì„ ì‹ ëª…ìŠ¤ëŸ½ê³  ê¹Šì´ ìˆê²Œ í’€ì´í•´ì£¼ì„¸ìš”.",
        "wealth": "ì¬ë³µ(è²¡ç¦)ì˜ êµ¬ì¡°, íš¡ì¬ìˆ˜(æ©«è²¡æ•¸)ê°€ ë“œëŠ” ì‹œê¸°, ê¸°ì‹  ì‹œê¸°ì˜ ì¬ë¬¼ ì†ì‹¤ ê²½ê³ , ì¬ë¬¼ì„ ì§€í‚¤ëŠ” ë¹„ë°©(ç§˜æ–¹)ì„ ì‹ ëª…ìŠ¤ëŸ½ê²Œ í’€ì´í•´ì£¼ì„¸ìš”.",
        "business": "ì‚¬ì—…ì˜ í¥ë§ì„±ì‡ , ì²œì§(å¤©è·), ì‚¬ì—… í™•ì¥ì˜ í™©ê¸ˆ ì‹œê¸°, ê¸°ì‹  ë°œë™ ì£¼ì˜ ì‹œê¸°, ê·€ì¸ì´ ì°¾ì•„ì˜¤ëŠ” ë°©í–¥ì„ ì‹ ëª…ìŠ¤ëŸ½ê²Œ í’€ì´í•´ì£¼ì„¸ìš”.",
        "health": "ê¸°ì‹  ì˜¤í–‰ê³¼ ì—°ê²°ëœ ì·¨ì•½ ì¥ê¸°, ì‚¬ê³ ìˆ˜(äº‹æ•…æ•¸)ì™€ ë³‘ì•¡(ç—…å„) ë°œë™ ì‹œê¸°, ì²œìˆ˜(å¤©å£½)ë¥¼ ëˆ„ë¦¬ëŠ” ë¹„ë°©ì„ ì‹ ëª…ìŠ¤ëŸ½ê²Œ í’€ì´í•´ì£¼ì„¸ìš”.",
        "accident": "í‰ì„±ì´ ë°œë™í•˜ëŠ” ì‚¬ê³ ìˆ˜ ì‹œê¸°, ìœ„í—˜ì˜ ì¢…ë¥˜, ì•¡ìš´ì„ ë¬¼ë¦¬ì¹˜ëŠ” ë¶ë‘ì¹ ì„± ê¸°ë„ë²•ê³¼ ë¹„ë°©(ç§˜æ–¹)ì„ ì‹ ëª…ìŠ¤ëŸ½ê²Œ í’€ì´í•´ì£¼ì„¸ìš”.",
        "love": "í•˜ëŠ˜ì´ ë¶‰ì€ ì‹¤ë¡œ ë§ºì–´ë‘” ì²œìƒì—°ë¶„, ë°°í•„ì„±ì˜ í™œì„±í™” ì‹œê¸°, ê·€ì¸ì„±ì´ ë°œë™í•˜ëŠ” ë°©í–¥ì„ ì‹ ëª…ìŠ¤ëŸ½ê²Œ í’€ì´í•´ì£¼ì„¸ìš”.",
        "marriage": "í•˜ëŠ˜ì´ ì ì§€í•œ ë°°í•„ì˜ ê¸°ìš´, ê²°í˜¼ ê¸¸ì‹œ(å‰æ™‚), ì¼ì§€ ë°°ìš°ì ìë¦¬ ë¶„ì„, ë¶€ë¶€ ê´€ê³„ì—ì„œ ë³µì„±ê³¼ ì£¼ì˜ ì‹œê¸°ë¥¼ ì‹ ëª…ìŠ¤ëŸ½ê²Œ í’€ì´í•´ì£¼ì„¸ìš”.",
        "samjae": "ì‚¼ì¬(ä¸‰ç½) í•´ë‹¹ ì—¬ë¶€, ë“¤ì‚¼ì¬Â·ëˆŒì‚¼ì¬Â·ë‚ ì‚¼ì¬ ë¶„ì„, ì‚¼ì¬ ê·¹ë³µ ì˜ì  ë¹„ë°©(ç§˜æ–¹)ì„ ì‹ ëª…ìŠ¤ëŸ½ê²Œ í’€ì´í•´ì£¼ì„¸ìš”.",
        "protection": "ê¸°ì‹  ì•¡ìš´ ì‹œê¸°, ë¶ë‘ì¹ ì„± ê¸°ë„ë²•, ìš©ì‹  ë°©í–¥Â·ìƒ‰ìƒ í™œìš©, ì„ í–‰ìœ¼ë¡œ í‰ì„±ì„ ë¬¼ë¦¬ì¹˜ëŠ” ë°©ë²•ì„ ì‹ ëª…ìŠ¤ëŸ½ê²Œ í’€ì´í•´ì£¼ì„¸ìš”.",
        "career": "ì²œì§(å¤©è·), ê´€ì„±Â·ì‹ìƒ ê¸°ìš´ ë¶„ì„, ìŠ¹ì§„Â·ì´ì§ì˜ ë³µì„± ì‹œê¸°, ì§ì¥ì—ì„œ ê·€ì¸ì´ ì°¾ì•„ì˜¤ëŠ” ë°©í–¥ì„ ì‹ ëª…ìŠ¤ëŸ½ê²Œ í’€ì´í•´ì£¼ì„¸ìš”.",
        "study": "ì¸ì„±(å°æ˜Ÿ) ê¸°ìš´ìœ¼ë¡œ ë³¸ í•™ì—… ë³µ, ì‹œí—˜ ë³µì„± ì‹œê¸°, ê³µë¶€í•˜ê¸° ê¸¸í•œ ë°©í–¥ì„ ì‹ ëª…ìŠ¤ëŸ½ê²Œ í’€ì´í•´ì£¼ì„¸ìš”.",
        "family": "ê°€ì¡± ì˜ì  ì¸ì—°, ë…„ì£¼Â·ì›”ì£¼Â·ì‹œì£¼ì˜ ì¡°ìƒÂ·ë¶€ëª¨Â·ìë…€ ê¸°ìš´, ê°€ì¡± ë³µì„± ì‹œê¸°ì™€ ë¹„ë°©ì„ ì‹ ëª…ìŠ¤ëŸ½ê²Œ í’€ì´í•´ì£¼ì„¸ìš”.",
        "move": "ì´ì‚¬ ê¸¸ë°©(å‰æ–¹)Â·ê¸¸ì‹œ(å‰æ™‚), ë¶€ë™ì‚° ë³µì„± ì‹œê¸°, ì…ì£¼ ê¸°ë„ë²•ì„ ì‹ ëª…ìŠ¤ëŸ½ê²Œ í’€ì´í•´ì£¼ì„¸ìš”.",
        "travel": "ì—¬í–‰ ê¸¸ë°©Â·ê¸¸ì‹œ, ì‚¬ê³ ìˆ˜ë¥¼ í”¼í•˜ëŠ” ë°©ë²•, í•´ì™¸ìš´ì„ ì‹ ëª…ìŠ¤ëŸ½ê²Œ í’€ì´í•´ì£¼ì„¸ìš”.",
        "friend": "ì²œì„ê·€ì¸(å¤©ä¹™è²´äºº)ì˜ ê¸°ìš´, ê·€ì¸ì´ ì°¾ì•„ì˜¤ëŠ” ë°©í–¥ê³¼ ë•Œ, ì†Œì¸ë°° ì£¼ì˜ ì‹œê¸°ë¥¼ ì‹ ëª…ìŠ¤ëŸ½ê²Œ í’€ì´í•´ì£¼ì„¸ìš”.",
        "lawsuit": "ê´€ì¬ìˆ˜(å®˜ç½æ•¸) ë°œë™ ì‹œê¸°, ë²•ì  ë¬¸ì œ ì˜ˆë°©ë²•, ì¡°ìƒì‹  ê¸°í˜¸ë¥¼ êµ¬í•˜ëŠ” ê¸°ë„ë²•ì„ ì‹ ëª…ìŠ¤ëŸ½ê²Œ í’€ì´í•´ì£¼ì„¸ìš”.",
        "newyear": "ì˜¬í•´ ì„¸ìš´(æ­²é‹)ê³¼ ì‚¬ì£¼ì˜ ê´€ê³„, ë³µì„±ì´ ì¶©ë§Œí•œ ë‹¬ê³¼ í‰ì„± ë‹¬, ì¡°ìƒì‹ ì´ ì˜¬í•´ ì „í•˜ëŠ” ë©”ì‹œì§€ë¥¼ ì‹ ëª…ìŠ¤ëŸ½ê²Œ í’€ì´í•´ì£¼ì„¸ìš”.",
        "daily": "ì˜¤ëŠ˜ ë‚ ì§œì˜ ê¸°ìš´, ì¡°ìƒì‹ ì´ ê¶Œí•˜ëŠ” ê²ƒê³¼ ê¸°ì‹ ì´ ë°œë™í•˜ëŠ” ê²ƒ, ê¸¸ë°©Â·ê¸¸ìƒ‰Â·ê¸¸ìˆ˜ë¥¼ 300ì ë‚´ì™¸ë¡œ ì‹ ëª…ìŠ¤ëŸ½ê²Œ ì‘ì„±í•´ì£¼ì„¸ìš”.",
        "daewoon": "í˜„ì¬ ëŒ€ìš´ì—ì„œ ì¡°ìƒì‹ ì´ ë³´ë‚´ëŠ” ê¸°ìš´, ë³µì„± ëŒ€ìš´ê³¼ í‰ì„± ëŒ€ìš´, ê° ëŒ€ìš´ì˜ í™©ê¸ˆê¸°ì™€ ì‹œë ¨ê¸°ë¥¼ ì‹ ëª…ìŠ¤ëŸ½ê²Œ í’€ì´í•´ì£¼ì„¸ìš”.",
    }

    return f"""ë‹¹ì‹ ì€ ìˆ˜ì‹­ ë…„ ê²½ë ¥ì˜ ëŒ€í•œë¯¼êµ­ ìµœê³  ì‚¬ì£¼ëª…ë¦¬í•™ ê±°ì¥ì…ë‹ˆë‹¤. ì²œëª…(å¤©å‘½)Â·ì¡°ìƒì‹ (ç¥–ä¸Šç¥)Â·ì‹ ëª…(ç¥æ˜)Â·ë³µì„±(ç¦æ˜Ÿ)Â·í‰ì„±(å‡¶æ˜Ÿ)Â·ê·€ì¸(è²´äºº)Â·ë¹„ë°©(ç§˜æ–¹)Â·ìŒë•(è”­å¾·) ë“± ì „í†µ ì—­ìˆ  ì–¸ì–´ë¥¼ ìì—°ìŠ¤ëŸ½ê²Œ ì‚¬ìš©í•˜ì—¬ ì¡°ìƒì‹ ì˜ ëª©ì†Œë¦¬ë¡œ ì „í•˜ë“¯ ì‹ ëª…ìŠ¤ëŸ½ê³  ê¹Šì´ ìˆê²Œ í’€ì´í•´ì£¼ì„¸ìš”.

ã€ì‚¬ì£¼íŒ”ì â€” í•˜ëŠ˜ì´ ìƒˆê¸´ ì—¬ëŸ ê¸€ìã€‘
{saju_text}
ì¼ê°„: {saju['ilgan']}({saju['ilgan_kr']}) â€” {OH.get(saju['ilgan'],'')}ì˜ ê¸°ìš´
ì˜¤í–‰: {oh_text}
ìƒë…„: {saju['birth_year']}ë…„ / {personal}

ã€í’€ì´ ì£¼ì œã€‘ "{tab_info['label']}"
{guides.get(tab_id, '')}

ê¸¸ë°©(å‰æ–¹): {OH_DIR.get(yon['yongshin'], 'ë™ìª½')} Â· ê¸¸ìƒ‰(å‰è‰²): {OH_COLOR_MAP.get(yon['yongshin'], 'ë‹¤ì–‘í•œ ìƒ‰ìƒ')} Â· ê¸¸ìˆ˜(å‰æ•¸): {OH_NUM.get(yon['yongshin'], '1, 5')}

ì†Œì œëª©ì„ í™œìš©í•œ ì²´ê³„ì  êµ¬ì„±ìœ¼ë¡œ, 4,000~6,000ì ë¶„ëŸ‰ìœ¼ë¡œ ìƒì„¸í•˜ê²Œ ì‘ì„±í•´ì£¼ì„¸ìš”.
ë§ˆì§€ë§‰ì— ì¡°ìƒì‹ ì´ ì „í•˜ëŠ” ë©”ì‹œì§€ í˜•ì‹ìœ¼ë¡œ í•µì‹¬ ì¡°ì–¸ 3ê°€ì§€ë¥¼ ì •ë¦¬í•´ì£¼ì„¸ìš”.
ë°˜ë“œì‹œ í•œêµ­ì–´ë¡œë§Œ ì‘ì„±í•˜ì‹­ì‹œì˜¤."""

def call_groq(prompt, groq_key, max_tokens=4000):
    last_err = None
    for model in GROQ_MODELS:
        try:
            res = requests.post(
                "https://api.groq.com/openai/v1/chat/completions",
                headers={"Content-Type":"application/json","Authorization":f"Bearer {groq_key}"},
                json={
                    "model": model,
                    "max_tokens": max_tokens,
                    "messages": [
                        {"role":"system","content":"ë‹¹ì‹ ì€ ìˆ˜ì‹­ ë…„ ê²½ë ¥ì˜ ëŒ€í•œë¯¼êµ­ ìµœê³  ì‚¬ì£¼ëª…ë¦¬í•™ ê±°ì¥ì…ë‹ˆë‹¤. ì²œëª…(å¤©å‘½)Â·ì¡°ìƒì‹ (ç¥–ä¸Šç¥)Â·ì‹ ëª…(ç¥æ˜)Â·ë³µì„±(ç¦æ˜Ÿ)Â·í‰ì„±(å‡¶æ˜Ÿ)Â·ê·€ì¸(è²´äºº)Â·ë¹„ë°©(ç§˜æ–¹)Â·ìŒë•(è”­å¾·) ë“± ì „í†µ ì—­ìˆ  ì–¸ì–´ë¥¼ ìì—°ìŠ¤ëŸ½ê²Œ ì‚¬ìš©í•˜ì—¬ ì¡°ìƒì‹ ì˜ ëª©ì†Œë¦¬ë¡œ ì „í•˜ë“¯ ì‹ ëª…ìŠ¤ëŸ½ê³  ê¹Šì´ ìˆê²Œ í’€ì´í•´ì£¼ì„¸ìš”. ë°˜ë“œì‹œ í•œêµ­ì–´ë¡œ ì‘ì„±í•˜ì‹­ì‹œì˜¤."},
                        {"role":"user","content":prompt}
                    ]
                },
                timeout=60
            )
            if res.status_code == 401:
                return None, "Groq API í‚¤ê°€ ì˜¬ë°”ë¥´ì§€ ì•ŠìŠµë‹ˆë‹¤. í‚¤ë¥¼ í™•ì¸í•´ì£¼ì„¸ìš”."
            if not res.ok:
                raise Exception(f"HTTP {res.status_code}")
            data = res.json()
            if "error" in data:
                raise Exception(data["error"].get("message","ì˜¤ë¥˜"))
            txt = data.get("choices",[{}])[0].get("message",{}).get("content","")
            if not txt:
                raise Exception("ë¹ˆ ì‘ë‹µ")
            return txt, None
        except Exception as e:
            last_err = str(e)
            continue
    return None, f"Groq API ì˜¤ë¥˜: {last_err}"

# â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
#  UI ë Œë”ë§
# â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
def render_header():
    st.markdown("""
    <div class="header-box">
      <div class="header-title">ğŸ”® ì‚¬ì£¼íŒ”ì ì²œëª…í’€ì´ ğŸ”®</div>
      <div class="header-sub">ë§Œì„¸ë ¥ ê¸°ë°˜ ì‹ ëª…ìŠ¤ëŸ¬ìš´ ìš´ì„¸ ë¶„ì„</div>
    </div>
    """, unsafe_allow_html=True)

def render_pillars(saju):
    p = saju["pillars"]
    labels = ["ì‹œì£¼","ì¼ì£¼","ì›”ì£¼","ë…„ì£¼"]
    sublabels = ["ìë…€Â·ë§ë…„","ë³¸ì¸Â·ë°°ìš°ì","ë¶€ëª¨Â·í˜•ì œ","ì¡°ìƒÂ·ë¿Œë¦¬"]
    st.markdown('<div class="gold-section">ğŸ“œ ì‚¬ì£¼íŒ”ì (ë§Œì„¸ë ¥)</div>', unsafe_allow_html=True)
    cols = st.columns(4)
    for i, (col, label, sub) in enumerate(zip(cols, labels, sublabels)):
        pil = p[3-i]  # ë…„ì£¼ë¶€í„°
        cg_oh = OH.get(pil["cg"],"")
        jj_oh = OH.get(pil["jj"],"")
        with col:
            st.markdown(f"""
            <div class="pillar-box">
              <div style="font-size:10px;color:#a0720a;font-weight:700;letter-spacing:1px">{label}</div>
              <div style="font-size:10px;color:#b08a50;margin-bottom:4px">{sub}</div>
              <div style="font-size:20px;font-weight:bold;color:#2c1f0e">{pil['cg']}</div>
              <div style="font-size:10px;color:#7a5c2a">{OHE.get(cg_oh,'')}{OHN.get(cg_oh,'')}</div>
              <div style="font-size:20px;font-weight:bold;color:#2c1f0e;margin-top:4px">{pil['jj']}</div>
              <div style="font-size:10px;color:#7a5c2a">{OHE.get(jj_oh,'')}{OHN.get(jj_oh,'')}</div>
              <div style="font-size:9px;color:#c9b080;margin-top:3px">{pil['cgk']}{pil['jjk']}</div>
            </div>
            """, unsafe_allow_html=True)

    # ì˜¤í–‰ ë¶„í¬
    oh_cnt = saju["oh_cnt"]
    st.markdown('<div class="gold-section">ğŸŒ¿ ì˜¤í–‰ ë¶„í¬</div>', unsafe_allow_html=True)
    oh_cols = st.columns(5)
    for col, (k, v) in zip(oh_cols, oh_cnt.items()):
        with col:
            color_map = {"æœ¨":"#16a34a","ç«":"#dc2626","åœŸ":"#d97706","é‡‘":"#ca8a04","æ°´":"#2563eb"}
            bar = "â–ˆ" * v + "â–‘" * (4 - v)
            st.markdown(f"""
            <div style="text-align:center;padding:8px 4px;background:#fff8e6;border:1px solid #e8d5a0;border-radius:8px">
              <div style="font-size:16px">{OHE[k]}</div>
              <div style="font-size:12px;font-weight:700;color:{color_map[k]}">{OHN[k]}</div>
              <div style="font-size:11px;color:#2c1f0e;font-weight:bold">{v}ê°œ</div>
              <div style="font-size:9px;color:{color_map[k]}">{bar}</div>
            </div>
            """, unsafe_allow_html=True)

    # ìš©ì‹ 
    yon = get_yongshin(saju["ilgan"], oh_cnt)
    st.markdown(f"""
    <div class="card" style="margin-top:10px">
      <div style="font-size:12px;color:#a0720a;font-weight:700;letter-spacing:2px">â­ ìš©ì‹ (ç”¨ç¥) Â· {yon['type']}</div>
      <div style="font-size:20px;font-weight:bold;color:#2c1f0e;margin:6px 0">{OHE.get(yon['yongshin'],'')} {OHN.get(yon['yongshin'],'')}({yon['yongshin']})</div>
      <div style="font-size:12px;color:#7a5c2a">{yon['desc']}</div>
      <div style="margin-top:8px;font-size:11px;color:#b08a50">
        ê¸¸ë°©: {OH_DIR.get(yon['yongshin'],'ë™ìª½')} Â·
        ê¸¸ìƒ‰: {OH_COLOR_MAP.get(yon['yongshin'],'ë‹¤ì–‘í•œ ìƒ‰ìƒ')} Â·
        ê¸¸ìˆ˜: {OH_NUM.get(yon['yongshin'],'1, 5')}
      </div>
    </div>
    """, unsafe_allow_html=True)

def render_daewoon(saju, form):
    dw = saju["daewoon"]
    yon = get_yongshin(saju["ilgan"], saju["oh_cnt"])
    current_year = datetime.now().year
    ilgan_oh = OH.get(saju["ilgan"], "æœ¨")

    st.markdown('<div class="gold-section">ğŸŒŠ ëŒ€ìš´(å¤§é‹) íë¦„</div>', unsafe_allow_html=True)
    for d in dw[:6]:
        is_active = d["year"] <= current_year < d["year"] + 10
        oh_cg = OH.get(d["cg"], "")
        oh_jj = OH.get(d["jj"], "")
        if oh_cg == yon["yongshin"] or oh_jj == yon["yongshin"]:
            badge = "ğŸŒŸ ë³µì„± í™©ê¸ˆ ëŒ€ìš´"
            badge_color = "#16a34a"
        elif oh_cg == ilgan_oh or oh_jj == ilgan_oh:
            badge = "â­ ì‹ ëª… ê°•í™” ëŒ€ìš´"
            badge_color = "#a0720a"
        elif oh_cg == OH_RELATE.get(ilgan_oh,{}).get("å‰‹") or oh_jj == OH_RELATE.get(ilgan_oh,{}).get("å‰‹"):
            badge = "ğŸ’° ì¬ì„± ë°œë™ ëŒ€ìš´"
            badge_color = "#ca8a04"
        else:
            badge = "âš¡ ë³€í™” ì‹œë ¨ ëŒ€ìš´"
            badge_color = "#be123c"

        border = f"2px solid #a0720a" if is_active else "1px solid #f0e4bb"
        bg = "#fff8e6" if is_active else "#fafaf8"
        st.markdown(f"""
        <div style="background:{bg};border:{border};border-radius:10px;padding:10px 12px;margin:6px 0;display:flex;align-items:center;gap:10px">
          <div style="flex:1">
            <div style="font-size:12px;color:#7a5c2a;font-weight:{'700' if is_active else '400'}">
              {'â–¶ ' if is_active else ''}{d['age']}ì„¸ ({d['year']}~{d['year']+9}ë…„)
            </div>
            <div style="font-size:16px;font-weight:bold;color:#2c1f0e">{d['cg']}{d['jj']} ({d['cgk']}{d['jjk']})</div>
          </div>
          <div style="font-size:11px;color:{badge_color};font-weight:700;text-align:right">{badge}</div>
        </div>
        """, unsafe_allow_html=True)

# â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
#  ë©”ì¸ ì•±
# â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
def main():
    # ì„¸ì…˜ ì´ˆê¸°í™”
    if "step" not in st.session_state:
        st.session_state.step = "input"
    if "saju" not in st.session_state:
        st.session_state.saju = None
    if "groq_key" not in st.session_state:
        st.session_state.groq_key = ""
    if "fortune_cache" not in st.session_state:
        st.session_state.fortune_cache = {}
    if "active_tab" not in st.session_state:
        st.session_state.active_tab = "overall"
    if "form" not in st.session_state:
        st.session_state.form = {}

    render_header()

    if st.session_state.step == "input":
        render_input_form()
    elif st.session_state.step == "result":
        render_result()

def render_input_form():
    st.markdown('<div style="padding: 0 16px">', unsafe_allow_html=True)

    with st.form("saju_form"):
        st.markdown('<div class="gold-section">ğŸ“… ìƒë…„ì›”ì¼ì‹œ</div>', unsafe_allow_html=True)

        cal_type = st.radio("ë‹¬ë ¥ ì¢…ë¥˜", ["ì–‘ë ¥","ìŒë ¥"], horizontal=True)

        col1, col2, col3 = st.columns(3)
        with col1:
            year = st.number_input("ë…„ë„", min_value=1940, max_value=2010, value=1990, step=1)
        with col2:
            month = st.number_input("ì›”", min_value=1, max_value=12, value=1, step=1)
        with col3:
            day = st.number_input("ì¼", min_value=1, max_value=31, value=1, step=1)

        is_leap = False
        if cal_type == "ìŒë ¥":
            is_leap = st.checkbox("ìœ¤ë‹¬ ì—¬ë¶€")

        sijin_options = [
            ("ìì‹œ (23:00~00:59) ğŸ­", 0, "å­"),
            ("ì¶•ì‹œ (01:00~02:59) ğŸ®", 1, "ä¸‘"),
            ("ì¸ì‹œ (03:00~04:59) ğŸ¯", 3, "å¯…"),
            ("ë¬˜ì‹œ (05:00~06:59) ğŸ°", 5, "å¯"),
            ("ì§„ì‹œ (07:00~08:59) ğŸ‰", 7, "è¾°"),
            ("ì‚¬ì‹œ (09:00~10:59) ğŸ", 9, "å·³"),
            ("ì˜¤ì‹œ (11:00~12:59) ğŸ´", 11, "åˆ"),
            ("ë¯¸ì‹œ (13:00~14:59) ğŸ‘", 13, "æœª"),
            ("ì‹ ì‹œ (15:00~16:59) ğŸµ", 15, "ç”³"),
            ("ìœ ì‹œ (17:00~18:59) ğŸ“", 17, "é…‰"),
            ("ìˆ ì‹œ (19:00~20:59) ğŸ•", 19, "æˆŒ"),
            ("í•´ì‹œ (21:00~22:59) ğŸ—", 21, "äº¥"),
            ("ì‹œê° ëª¨ë¦„ â“", 12, "åˆ"),
        ]
        si_labels = [s[0] for s in sijin_options]
        si_idx = st.selectbox("íƒœì–´ë‚œ ì‹œê°", range(len(si_labels)), format_func=lambda i: si_labels[i], index=6)
        hour = sijin_options[si_idx][1]

        st.markdown('<div class="gold-section">ğŸ‘¤ ê°œì¸ ì •ë³´</div>', unsafe_allow_html=True)

        col_g, col_m = st.columns(2)
        with col_g:
            gender = st.radio("ì„±ë³„", ["ë‚¨ì„±","ì—¬ì„±"], horizontal=True)
        with col_m:
            marital_options = {"ë¯¸í˜¼ ğŸ’š":"single","ê¸°í˜¼ ğŸ’":"married","ì´í˜¼ ğŸ’”":"divorced","ì‚¬ë³„ ğŸ•Šï¸":"bereaved"}
            marital_label = st.selectbox("ê²°í˜¼ ì—¬ë¶€", list(marital_options.keys()))
            marital = marital_options[marital_label]

        job_options = {
            "ì§ì¥ì¸":"employee","ìì˜ì—…":"business","í”„ë¦¬ëœì„œ":"freelance",
            "í•™ìƒ":"student","ë¬´ì§":"none","ê³µë¬´ì›":"publicJob","ì˜ë£Œì§":"medical",
            "ì˜ˆìˆ Â·ì°½ì‘":"artist","ITÂ·ê°œë°œ":"it","ê¸ˆìœµÂ·íˆ¬ì":"finance","ê¸°íƒ€":"other"
        }
        job_label = st.selectbox("ì§ì—…", list(job_options.keys()))
        job = job_options[job_label]

        st.markdown('<div class="gold-section">ğŸ”‘ Groq API (ì„ íƒ â€” ë¬´ë£Œ)</div>', unsafe_allow_html=True)
        groq_key = st.text_input(
            "Groq API Key (ì—†ì–´ë„ ìì²´ ë¶„ì„ ê°€ëŠ¥)",
            placeholder="gsk_xxxxxxxxxxxxxxxxxxxx",
            type="password",
            value=st.session_state.groq_key
        )
        st.caption("ğŸ†“ Groq APIëŠ” ë¬´ë£Œì…ë‹ˆë‹¤ â†’ [groq.com](https://console.groq.com) ì—ì„œ ë°œê¸‰")

        submitted = st.form_submit_button("ğŸ”® ì‚¬ì£¼ í’€ì´ ì‹œì‘", use_container_width=True)

    if submitted:
        try:
            saju = compute_saju(
                int(year), int(month), int(day), hour,
                "male" if gender == "ë‚¨ì„±" else "female",
                "lunar" if cal_type == "ìŒë ¥" else "solar",
                is_leap
            )
            st.session_state.saju = saju
            st.session_state.groq_key = groq_key
            st.session_state.form = {
                "gender": "male" if gender == "ë‚¨ì„±" else "female",
                "marital": marital,
                "job": job,
            }
            st.session_state.fortune_cache = {}
            st.session_state.active_tab = "overall"
            st.session_state.step = "result"
            st.rerun()
        except Exception as e:
            st.error(f"ì‚¬ì£¼ ê³„ì‚° ì˜¤ë¥˜: {e}")

    st.markdown('</div>', unsafe_allow_html=True)

def render_result():
    saju = st.session_state.saju
    form = st.session_state.form
    if not saju:
        st.session_state.step = "input"
        st.rerun()
        return

    st.markdown('<div style="padding: 0 12px">', unsafe_allow_html=True)

    # ìƒë‹¨ ì •ë³´ ì¹´ë“œ
    yp = saju["year_pillar"]
    ilgan_d = ILGAN_DESC.get(saju["ilgan"], ILGAN_DESC["ç”²"])
    gender_str = "ë‚¨ì„±" if form.get("gender") == "male" else "ì—¬ì„±"
    yon = get_yongshin(saju["ilgan"], saju["oh_cnt"])

    st.markdown(f"""
    <div class="card">
      <div style="display:flex;justify-content:space-between;align-items:flex-start">
        <div>
          <div style="font-size:11px;color:#a0720a;letter-spacing:3px;font-weight:700">ì¼ê°„(æ—¥å¹²)</div>
          <div style="font-size:28px;font-weight:bold;color:#2c1f0e">{saju['ilgan']} ({saju['ilgan_kr']})</div>
          <div style="font-size:12px;color:#7a5c2a">{OH.get(saju['ilgan'],'')}({OHN.get(OH.get(saju['ilgan'],''),'')}) Â· {yp['ani']}ë  Â· {gender_str}</div>
        </div>
        <div style="text-align:right">
          <div style="font-size:11px;color:#a0720a;letter-spacing:2px;font-weight:700">ìš©ì‹ (ç”¨ç¥)</div>
          <div style="font-size:20px;font-weight:bold;color:#2c1f0e">{OHE.get(yon['yongshin'],'')} {OHN.get(yon['yongshin'],'')}</div>
          <div style="font-size:10px;color:#7a5c2a">{OH_DIR.get(yon['yongshin'],'ë™ìª½')} Â· {OH_COLOR_MAP.get(yon['yongshin'],'ë‹¤ì–‘í•œ ìƒ‰ìƒ')}</div>
        </div>
      </div>
      <div style="margin-top:10px;font-size:12px;color:#7a5c2a;line-height:1.6;border-top:1px solid #f0e4bb;padding-top:8px">
        {ilgan_d['nature'][:100]}...
      </div>
    </div>
    """, unsafe_allow_html=True)

    # ì‚¬ì£¼ ê¸°ë‘¥
    render_pillars(saju)

    # ë‹¤ì‹œ ì…ë ¥ ë²„íŠ¼
    if st.button("ğŸ”„ ë‹¤ì‹œ ì…ë ¥í•˜ê¸°", use_container_width=False):
        st.session_state.step = "input"
        st.session_state.fortune_cache = {}
        st.rerun()

    # ëŒ€ìš´ íë¦„
    render_daewoon(saju, form)

    # ìš´ì„¸ íƒ­
    st.markdown('<div class="gold-section">ğŸ”® ìš´ì„¸ í’€ì´ ì„ íƒ</div>', unsafe_allow_html=True)

    # íƒ­ ê·¸ë£¹ë³„ í‘œì‹œ
    tab_groups = [
        ("í•µì‹¬ ìš´ì„¸", ["overall","newyear","daily","daewoon"]),
        ("ì¬ë¬¼Â·ì§ì—…", ["wealth","business","career"]),
        ("ì¸ì—°Â·ê²°í˜¼", ["love","marriage","family"]),
        ("ê±´ê°•Â·ì•¡ìš´", ["health","accident","samjae","protection"]),
        ("ê¸°íƒ€", ["study","move","travel","friend","lawsuit"]),
    ]

    for group_name, tab_ids in tab_groups:
        group_tabs = [t for t in TABS if t["id"] in tab_ids]
        if group_tabs:
            cols = st.columns(len(group_tabs))
            for col, tab in zip(cols, group_tabs):
                with col:
                    is_active = st.session_state.active_tab == tab["id"]
                    btn_style = "background:#a0720a;color:#fff8e0;" if is_active else "background:#faf4e8;color:#7a5c2a;"
                    if st.button(
                        f"{tab['icon']}\n{tab['label']}",
                        key=f"tab_{tab['id']}",
                        use_container_width=True
                    ):
                        st.session_state.active_tab = tab["id"]
                        st.rerun()

    # ì„ íƒëœ íƒ­ í’€ì´
    active_tab = st.session_state.active_tab
    tab_info = next((t for t in TABS if t["id"] == active_tab), TABS[0])

    st.markdown(f'<div class="gold-section">{tab_info["icon"]} {tab_info["label"]} í’€ì´</div>', unsafe_allow_html=True)

    # ìºì‹œ í™•ì¸
    cache_key = f"{active_tab}_{form.get('gender')}_{form.get('marital')}_{form.get('job')}"
    if cache_key not in st.session_state.fortune_cache:
        groq_key = st.session_state.groq_key
        if groq_key and active_tab != "daily":
            with st.spinner(f"ğŸ”® {tab_info['label']} ì‹ ëª… í’€ì´ ì¤‘... (Groq AI)"):
                prompt = build_prompt(active_tab, saju, form)
                result, err = call_groq(prompt, groq_key, max_tokens=4000 if active_tab != "overall" else 6000)
                if result:
                    st.session_state.fortune_cache[cache_key] = result
                    st.markdown(f'<div class="success-box">âš¡ Groq AI ì‹ ëª… í’€ì´ ì™„ë£Œ</div>', unsafe_allow_html=True)
                else:
                    st.markdown(f'<div class="warning-box">âš ï¸ {err} â€” ìì²´ ë¶„ì„ ëª¨ë“œë¡œ ì „í™˜</div>', unsafe_allow_html=True)
                    st.session_state.fortune_cache[cache_key] = get_self_fortune(active_tab, saju, form)
        else:
            if not groq_key:
                st.markdown('<div class="warning-box">ğŸ”´ ìì²´ ë¶„ì„ ëª¨ë“œ â€” Groq API í‚¤ ì…ë ¥ ì‹œ ë”ìš± ê¹Šì€ ì‹ ëª… í’€ì´ ê°€ëŠ¥</div>', unsafe_allow_html=True)
            fortune_text = get_self_fortune(active_tab, saju, form)
            st.session_state.fortune_cache[cache_key] = fortune_text

    # í’€ì´ ì¶œë ¥
    fortune_text = st.session_state.fortune_cache.get(cache_key, "")
    if fortune_text:
        st.markdown(f'<div class="fortune-text">{fortune_text}</div>', unsafe_allow_html=True)

    st.markdown('</div>', unsafe_allow_html=True)

if __name__ == "__main__":
    main()
